<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALMS - Attendance & Leave Management System</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzAwNkZBRiIvPgo8cGF0aCBkPSJNMTAgMTJIMzBWMTZIMTBWMTJaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTAgMjBIMzBWMjRIMTBWMjBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTAgMjhIMzBWMzJIMTBWMjhaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K" alt="CMRL Logo">
                    <span class="logo-text">ALMS</span>
                </div>
                <nav class="nav">
                    <ul class="nav-list">
                        <li><a href="#dashboard" class="nav-link active">Dashboard</a></li>
                        <li><a href="#attendance" class="nav-link">Attendance</a></li>
                        <li data-role="employee"><a href="#leave-applications" class="nav-link">Leave Applications</a></li>
                        <li data-role="admin"><a href="#employees" class="nav-link">Employees</a></li>
                        <li data-role="manager"><a href="#leave-approvals" class="nav-link">Leave Sanction/Reject</a></li>
                        <li data-role="manager"><a href="#reports" class="nav-link">Reports</a></li>
                        <li data-role="manager"><a href="#holidays" class="nav-link">Holidays</a></li>
                        <li data-role="admin"><a href="#settings" class="nav-link">Settings</a></li>
                    </ul>
                </nav>
                <div class="user-menu">
                    <div class="user-info">
                        <span class="user-name">Admin User</span>
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()" style="margin-left: 10px;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    <script>
                        function logout() {
                            localStorage.removeItem("loggedInUser");
                            window.location.href = "login.html";
}
                    </script>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="dashboard-container">
                    <div class="dashboard-header">
                        <h1>Dashboard</h1>
                    </div>
                    
                    <div class="dashboard-grid">
                        <!-- Quick Actions Section (moved above Overview as requested) -->
                        <div class="quick-actions-section">
                            <h2>Quick Actions</h2>
                            <div class="quick-actions-grid">
                                <button class="quick-action-btn approve-btn" onclick="approveLeaves()" data-role="manager">
                                    <i class="fas fa-clock"></i>
                                    <span>Approve Leaves</span>
                                </button>
                                <button class="quick-action-btn" onclick="showSection('attendance')" data-role="employee">
                                    <i class="fas fa-clipboard-list"></i>
                                    <span>Mark Attendance</span>
                                </button>
                                <button class="quick-action-btn" onclick="showLeaveApplyModal()" data-role="employee">
                                    <i class="fas fa-file-alt"></i>
                                    <span>Apply Leave</span>
                                </button>
                                <button class="quick-action-btn" onclick="showSection('reports')" data-role="manager">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>Generate Reports</span>
                                </button>
                                <button class="quick-action-btn" onclick="showSection('employees')" data-role="manager">
                                    <i class="fas fa-eye"></i>
                                    <span>View Employees</span>
                                </button>
                            </div>
                        </div>

                        <!-- Overview Section -->
                        <div class="overview-section">
                            <h2>Overview</h2>
                            <div class="overview-stats">
                                <div class="overview-item">
                                    <span class="overview-label">Total Employees</span>
                                    <span class="overview-number">250</span>
                                </div>
                                <div class="overview-item">
                                    <span class="overview-label">Active Leaves</span>
                                    <span class="overview-number">15</span>
                                </div>
                                <div class="overview-item">
                                    <span class="overview-label">Upcoming Holidays</span>
                                    <span class="overview-number">3</span>
                                </div>
                            </div>
                        </div>

                        <!-- Pending Tasks Section -->
                        <div class="pending-tasks-section">
                            <h2>Pending Tasks</h2>
                            <div class="pending-tasks-list">
                                <div class="pending-task-item">
                                    <i class="fas fa-clock"></i>
                                    <span>12 days attendance pending</span>
                                </div>
                                <div class="pending-task-item">
                                    <i class="fas fa-calendar-check"></i>
                                    <span>To Leave sanction pending</span>
                                </div>
                            </div>
                        </div>

                        <!-- System Notifications Section -->
                        <div class="notifications-section">
                            <h2>System Notifications</h2>
                            <div class="notifications-list">
                                <div class="notification-item">
                                    <i class="fas fa-user-plus"></i>
                                    <span>5 new employees onboarded this month</span>
                                </div>
                                <div class="notification-item">
                                    <i class="fas fa-calendar-times"></i>
                                    <span>2 employees on Leave in this month</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Attendance Section -->
            <section id="attendance" class="section">
                <!-- Employee View -->
                <div id="attendance-employee" class="attendance-employee">
                    <div class="attendance-hero">
                        <h1>Mark Your Attendance</h1>
                        <p>Welcome back! Please clock in to start your day.</p>
                    </div>
                    <div class="attendance-clock">
                        <span class="clock-label">Current Date & Time</span>
                        <div id="liveDateTime" class="clock-display">--</div>
                        <div class="clock-actions">
                            <button id="btnClockIn" class="btn clock-btn" onclick="handleClockIn()">
                                <i class="fas fa-play-circle"></i> Clock In
                            </button>
                            <button id="btnClockOut" class="btn clock-btn secondary" onclick="handleClockOut()">
                                <i class="fas fa-stop-circle"></i> Clock Out
                            </button>
                        </div>
                    </div>

                    <div class="attendance-summary">
                        <h2>Today's Summary</h2>
                        <div class="summary-row">
                            <div class="summary-item">
                                <i class="fas fa-sign-in-alt"></i>
                                <div>
                                    <div class="summary-label">Last Clock In</div>
                                    <div id="lastClockIn" class="summary-value">--</div>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-sign-out-alt"></i>
                                <div>
                                    <div class="summary-label">Last Clock Out</div>
                                    <div id="lastClockOut" class="summary-value">--</div>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-hourglass-half"></i>
                                <div>
                                    <div class="summary-label">Hours Worked Today</div>
                                    <div id="hoursWorked" class="summary-value">0 hours</div>
                                </div>
                            </div>
                        </div>
                        <div class="attendance-links">
                            <a href="#" onclick="showMyAttendanceReport()">My Attendance Report</a>
                        </div>
                    </div>
                </div>

                <!-- Admin/Manager View (existing management UI) -->
                <div id="attendance-management" class="attendance-container">
                    <div class="attendance-form">
                        <h2>Mark Attendance</h2>
                        <form id="attendanceForm">
                            <div class="form-group">
                                <label for="employeeId">Employee ID</label>
                                <input type="text" id="employeeId" placeholder="Enter Employee ID" required>
                            </div>
                            <div class="form-group">
                                <label for="attendanceType">Attendance Type</label>
                                <select id="attendanceType" required>
                                    <option value="">Select Type</option>
                                    <option value="present">Present</option>
                                    <option value="late">Late</option>
                                    <option value="absent">Absent</option>
                                    <option value="half-day">Half Day</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="attendanceTime">Time</label>
                                <input type="time" id="attendanceTime" required>
                            </div>
                            <div class="form-group">
                                <label for="remarks">Remarks (Optional)</label>
                                <textarea id="remarks" placeholder="Add any remarks..."></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Mark Attendance</button>
                        </form>
                    </div>

                    <div class="attendance-list">
                        <h2>Today's Attendance</h2>
                        <div class="attendance-filters">
                            <select id="departmentFilter">
                                <option value="">All Departments</option>
                                <option value="operations">Operations</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="admin">Administration</option>
                                <option value="security">Security</option>
                            </select>
                            <input type="text" id="searchEmployee" placeholder="Search employee...">
                        </div>
                        <div class="attendance-table-container">
                            <table class="attendance-table">
                                <thead>
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Status</th>
                                        <th>Time</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceTableBody">
                                    <!-- Attendance data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Leave Applications Section (Employee) -->
            <section id="leave-applications" class="section">
                <div class="section-header">
                    <h1>Leave Applications</h1>
                    <p>View and manage your leave applications</p>
                </div>

                <div class="leave-applications-container">
                    <div class="leave-applications-header">
                        <button class="btn btn-primary" onclick="showLeaveApplyModal()">
                            <i class="fas fa-plus"></i> Apply Leave
                        </button>
                        <div class="search-filters">
                            <input type="text" id="leaveSearchEmployee" placeholder="Search by Leave Type, Reason or Status...">
                        </div>
                    </div>

                    <div class="leave-applications-table-container">
                        <table class="leave-applications-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Leave Type</th>
                                    <th>Dates</th>
                                    <th>No. of Days</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="leaveApplicationsBody">
                                <!-- Leave applications data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Employees Section -->
            <section id="employees" class="section">
                <div class="section-header">
                    <h1>Employee Management</h1>
                    <p>Manage employee information and records</p>
                </div>

                <div class="employees-container">
                    <div class="employees-header">
                        <button class="btn btn-primary" onclick="showAddEmployeeModal()">
                            <i class="fas fa-plus"></i> Add Employee
                        </button>
                        <div class="search-filters">
                            <input type="text" id="employeeSearch" placeholder="Search employees...">
                            <select id="departmentFilterEmp">
                                <option value="">All Departments</option>
                                <option value="operations">Operations</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="admin">Administration</option>
                                <option value="security">Security</option>
                            </select>
                        </div>
                    </div>

                    <div class="employees-table-container">
                        <table class="employees-table">
                            <thead>
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Name</th>
                                    <th>Department</th>
                                    <th>Position</th>
                                    <th>Join Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="employeesTableBody">
                                <!-- Employee data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="section">
                <div class="section-header">
                    <h1>Reports & Analytics</h1>
                    <p>Generate attendance reports and view analytics</p>
                </div>

                <div class="reports-container">
                    <!-- Report Type -->
                    <div class="report-type">
                        <h2>Report Type</h2>
                        <p class="muted">Choose the type of report you'd like to generate.</p>
                        <div class="report-type-grid">
                            <button id="rt-attendance" class="report-type-card selected" data-report="attendance" onclick="selectReportType('attendance')">
                                <i class="fas fa-user-check"></i>
                                <span>Attendance Report</span>
                            </button>
                            <button id="rt-leave" class="report-type-card" data-report="leave" onclick="selectReportType('leave')">
                                <i class="fas fa-file-alt"></i>
                                <span>Leave Summary Report</span>
                            </button>
                        </div>
                    </div>

                    <div class="report-filters">
                        <div class="filter-group">
                            <label for="startDate">Start Date</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="filter-group">
                            <label for="endDate">End Date</label>
                            <input type="date" id="endDate">
                        </div>
                        <div class="filter-group">
                            <label for="reportDepartment">Department</label>
                            <select id="reportDepartment">
                                <option value="">All Departments</option>
                                <option value="operations">Operations</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="admin">Administration</option>
                                <option value="security">Security</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="reportEmployeeId">Employee ID (Optional)</label>
                            <input type="text" id="reportEmployeeId" placeholder="Enter Employee ID">
                        </div>
                        <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
                    </div>

                    <div class="report-results">
                        <div class="report-summary">
                            <h2>Report Summary</h2>
                            <div class="summary-cards">
                                <div class="summary-card">
                                    <h3>Total Working Days</h3>
                                    <p>22</p>
                                </div>
                                <div class="summary-card">
                                    <h3>Average Attendance</h3>
                                    <p>94.2%</p>
                                </div>
                                <div class="summary-card">
                                    <h3>Late Arrivals</h3>
                                    <p>45</p>
                                </div>
                                <div class="summary-card">
                                    <h3>Absences</h3>
                                    <p>78</p>
                                </div>
                            </div>
                        </div>

                        <div class="report-chart">
                            <h2>Attendance Trend</h2>
                            <canvas id="attendanceChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Leave Approvals Section (Manager) -->
            <section id="leave-approvals" class="section">
                <div class="section-header">
                    <h1>Leave Applications</h1>
                    <p>Review, sanction or reject pending leave requests</p>
                </div>

                <div class="reports-container">
                    <div class="employees-header" style="margin-bottom: 0;">
                        <div class="search-filters" style="width: 100%;">
                            <input type="text" id="leaveSearch" placeholder="Search by Employee ID, Name or Type..." style="flex:1;">
                        </div>
                    </div>

                    <div class="employees-table-container">
                        <table class="employees-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Leave Type</th>
                                    <th>Dates</th>
                                    <th>No. of Days</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="leaveApprovalsBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="section">
                <div class="section-header">
                    <h1>System Settings</h1>
                    <p>Configure system preferences and settings</p>
                </div>

                <div class="settings-container">
                    <div class="settings-tabs">
                        <button class="tab-btn active" onclick="showSettingsTab('general')">General</button>
                        <button class="tab-btn" onclick="showSettingsTab('attendance')">Attendance</button>
                        <button class="tab-btn" onclick="showSettingsTab('notifications')">Notifications</button>
                        <button class="tab-btn" onclick="showSettingsTab('security')">Security</button>
                    </div>

                    <div class="settings-content">
                        <div id="general-settings" class="settings-tab active">
                            <h2>General Settings</h2>
                            <form class="settings-form">
                                <div class="form-group">
                                    <label for="companyName">Company Name</label>
                                    <input type="text" id="companyName" value="Chennai Metro Rail Limited">
                                </div>
                                <div class="form-group">
                                    <label for="workingHours">Working Hours</label>
                                    <input type="text" id="workingHours" value="9:00 AM - 6:00 PM">
                                </div>
                                <div class="form-group">
                                    <label for="timezone">Timezone</label>
                                    <select id="timezone">
                                        <option value="IST">Indian Standard Time (IST)</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>

                        <div id="attendance-settings" class="settings-tab">
                            <h2>Attendance Settings</h2>
                            <form class="settings-form">
                                <div class="form-group">
                                    <label for="graceTime">Grace Time (minutes)</label>
                                    <input type="number" id="graceTime" value="15">
                                </div>
                                <div class="form-group">
                                    <label for="halfDayHours">Half Day Hours</label>
                                    <input type="number" id="halfDayHours" value="4">
                                </div>
                                <div class="form-group">
                                    <label for="autoLogout">Auto Logout (hours)</label>
                                    <input type="number" id="autoLogout" value="8">
                                </div>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>

                        <div id="notifications-settings" class="settings-tab">
                            <h2>Notification Settings</h2>
                            <form class="settings-form">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Email notifications for late arrivals</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>SMS notifications for absences</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox">
                                        <span>Weekly attendance reports</span>
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>

                        <div id="security-settings" class="settings-tab">
                            <h2>Security Settings</h2>
                            <form class="settings-form">
                                <div class="form-group">
                                    <label for="sessionTimeout">Session Timeout (minutes)</label>
                                    <input type="number" id="sessionTimeout" value="30">
                                </div>
                                <div class="form-group">
                                    <label for="passwordPolicy">Password Policy</label>
                                    <select id="passwordPolicy">
                                        <option value="strong">Strong (8+ chars, special chars)</option>
                                        <option value="medium">Medium (6+ chars)</option>
                                        <option value="weak">Weak (4+ chars)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Two-factor authentication</span>
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Employee</h2>
                <span class="close" onclick="closeAddEmployeeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addEmployeeForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newEmployeeId">Employee ID</label>
                            <input type="text" id="newEmployeeId" required>
                        </div>
                        <div class="form-group">
                            <label for="newEmployeeName">Full Name</label>
                            <input type="text" id="newEmployeeName" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newEmployeeDepartment">Department</label>
                            <select id="newEmployeeDepartment" required>
                                <option value="">Select Department</option>
                                <option value="operations">Operations</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="admin">Administration</option>
                                <option value="security">Security</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newEmployeePosition">Position</label>
                            <input type="text" id="newEmployeePosition" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newEmployeeEmail">Email</label>
                            <input type="email" id="newEmployeeEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="newEmployeePhone">Phone</label>
                            <input type="tel" id="newEmployeePhone" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newEmployeeJoinDate">Join Date</label>
                        <input type="date" id="newEmployeeJoinDate" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeAddEmployeeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Employee</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Apply Leave Modal -->
    <div id="applyLeaveModal" class="modal">
        <div class="modal-content leave-form-modal">
            <div class="modal-header">
                <h2>Apply for Leave</h2>
                <p class="modal-subtitle">Request time off from work</p>
                <span class="close" onclick="closeLeaveApplyModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Leave Balances Section -->
                <div class="leave-balances-section">
                    <h3>Leave Balances</h3>
                    <div class="leave-balances-grid">
                        <div class="leave-balance-item">
                            <span class="leave-type">Casual Leave (CL)</span>
                            <span class="leave-days">12 days</span>
                        </div>
                        <div class="leave-balance-item">
                            <span class="leave-type">Earned Leave (EL)</span>
                            <span class="leave-days">15 days</span>
                        </div>
                        <div class="leave-balance-item">
                            <span class="leave-type">Hospital Leave (HL)</span>
                            <span class="leave-days">7 days</span>
                        </div>
                    </div>
                </div>

                <!-- Leave Application Form -->
                <div class="leave-application-form">
                    <h3>Leave Application Form</h3>
                    <form id="applyLeaveForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="employeeIdLeave">Employee ID</label>
                                <input type="text" id="employeeIdLeave" value="EMP001" readonly>
                            </div>
                            <div class="form-group">
                                <label for="leaveType">Leave Type</label>
                                <select id="leaveType" required>
                                    <option value="">Select a leave type</option>
                                    <option value="Casual Leave">Casual Leave</option>
                                    <option value="Earned Leave">Earned Leave</option>
                                    <option value="Hospital Leave">Hospital Leave</option>
                                    <option value="Sick Leave">Sick Leave</option>
                                    <option value="Personal Leave">Personal Leave</option>
                                    <option value="Maternity Leave">Maternity Leave</option>
                                    <option value="Paternity Leave">Paternity Leave</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="leaveStart">Start Date</label>
                                <div class="date-input-container">
                                    <input type="date" id="leaveStart" required>
                                    <i class="fas fa-calendar-alt date-icon"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="leaveEnd">End Date</label>
                                <div class="date-input-container">
                                    <input type="date" id="leaveEnd" required>
                                    <i class="fas fa-calendar-alt date-icon"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="leaveDays">Number of Days</label>
                                <input type="number" id="leaveDays" min="1" required>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="awayFromHQ">
                                    <span>During Leave Away from HQ</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="leaveReason">Reason for Leave</label>
                            <textarea id="leaveReason" placeholder="Please provide a brief reason for your leave request." required></textarea>
                        </div>
                        
                        <div class="status-section">
                            <label>Status:</label>
                            <span class="status-pending">Pending Approval</span>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeLeaveApplyModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Submit Application</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Holiday Modal -->
    <div id="addHolidayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="holidayModalTitle">Add New Holiday</h2>
                <span class="close" onclick="closeAddHolidayModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addHolidayForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="holidayYear">Year</label>
                            <input type="number" id="holidayYear" min="2020" max="2030" required>
                        </div>
                        <div class="form-group">
                            <label for="holidayDate">Date</label>
                            <input type="date" id="holidayDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="holidayName">Name of the Holiday</label>
                        <input type="text" id="holidayName" placeholder="Enter holiday name" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeAddHolidayModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="holidaySubmitBtn">Add Holiday</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Attendance button handlers: disable Clock In after first click
        async function handleClockIn() {
            const inBtn = document.getElementById('btnClockIn');
            const outBtn = document.getElementById('btnClockOut');
            if (!inBtn) return;
            inBtn.disabled = true;
            inBtn.classList.add('disabled');
            try {
                const res = await fetch('/clockin', { method: 'POST', credentials: 'include' });
                const data = await res.json().catch(() => ({}));
                if (!res.ok) {
                    alert(data.error || 'Clock In failed');
                    inBtn.disabled = false;
                    inBtn.classList.remove('disabled');
                    return;
                }
                // success: show start time
                if (data.start_time) {
                    const el = document.getElementById('lastClockIn');
                    if (el) el.innerText = new Date(data.start_time).toLocaleString();
                }
                // enable clock out, keep clock in disabled
                if (outBtn) outBtn.disabled = false;
            } catch (err) {
                console.error('Clock in error', err);
                alert('Network error while clocking in');
                inBtn.disabled = false;
                inBtn.classList.remove('disabled');
            }
        }

        async function handleClockOut() {
            const inBtn = document.getElementById('btnClockIn');
            const outBtn = document.getElementById('btnClockOut');
            if (!outBtn) return;
            outBtn.disabled = true;
            outBtn.classList.add('disabled');
            try {
                const res = await fetch('/clockout', { method: 'POST', credentials: 'include' });
                const data = await res.json().catch(() => ({}));
                if (!res.ok) {
                    alert(data.error || 'Clock Out failed');
                    outBtn.disabled = false;
                    outBtn.classList.remove('disabled');
                    return;
                }
                // success: update lastClockOut and hours
                if (data.end_time) {
                    const el = document.getElementById('lastClockOut');
                    if (el) el.innerText = new Date(data.end_time).toLocaleString();
                }
                if (data.hours_worked !== undefined) {
                    const h = document.getElementById('hoursWorked');
                    if (h) h.innerText = data.hours_worked + ' hours';
                }
                // after clock out, allow clock in again
                if (inBtn) { inBtn.disabled = false; inBtn.classList.remove('disabled'); }
            } catch (err) {
                console.error('Clock out error', err);
                alert('Network error while clocking out');
                outBtn.disabled = false;
                outBtn.classList.remove('disabled');
            }
        }

        // Initialize button states based on whether user has an active clock-in
        async function initAttendanceButtons() {
            const inBtn = document.getElementById('btnClockIn');
            const outBtn = document.getElementById('btnClockOut');
            if (!inBtn || !outBtn) return;
            try {
                const res = await fetch('/api/attendance', { credentials: 'include' });
                if (!res.ok) {
                    // keep default enabled
                    return;
                }
                const rows = await res.json();
                // active if any row with end_time null
                const active = Array.isArray(rows) && rows.some(r => r.end_time === null || r.end_time === undefined);
                if (active) {
                    inBtn.disabled = true;
                    outBtn.disabled = false;
                } else {
                    inBtn.disabled = false;
                    outBtn.disabled = true;
                }
            } catch (err) {
                console.warn('initAttendanceButtons error', err);
            }
        }

        document.addEventListener('DOMContentLoaded', initAttendanceButtons);
    </script>
</body>
</html>
