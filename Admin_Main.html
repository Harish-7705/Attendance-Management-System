<!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ALMS - Manager Dashboard</title>
      <link rel="stylesheet" href="styles.css">
      <link rel="stylesheet" href="base.css">
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
      
  </head>
  <body>

<!-- Sidebar -->
<div id="sidebar" class="sidebar" aria-label="Main Navigation">
    <div class="sidebar-header">
    <div class="logo" id="sidebarLogo" style="cursor:pointer;">
        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzAwNkZBRiIvPgo8cGF0aCBkPSJNMTAgMTJIMzBWMTZIMTBWMTJaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTAgMjBIMzBWMjRIMTBWMjBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTAgMjhIMzBWMzJIMTBWMjhaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K" alt="CMRL Logo">
        <span class="logo-text">ALMS</span>
    </div>
</div>
    <nav class="sidebar-nav">
        <ul>
            <li><a href="#dashboard" class="nav-link">Dashboard</a></li>
            <li><a href="#attendance" class="nav-link">Attendance</a></li>
            <li><a href="#leave-applications" class="nav-link">Leave Application</a></li>
            <li><a href="#employee-directory" class="nav-link">Employee Directory</a></li>
            <li><a href="#reports" class="nav-link">Reports</a></li>
            <li><a href="#company-holiday-section" class" class="nav-link">Holidays</a></li>
            <li><a href="#leave-applications" class="nav-link">Leave Application</a></li>
            <li><a href="Leave_apply.html" onclick="window.location.href='Leave_apply.html'" class="nav-link">leave TEST</a></li>
        </ul>
    </nav>
    <div class="sidebar-user">
    <span class="user-name">Loading...</span>
    <i class="fas fa-user-tie"></i>
    <button class="btn btn-secondary" onclick="logout()" style="margin-left: 10px;">
        <i class="fas fa-sign-out-alt"></i> Logout
    </button>
</div>


<script>
  async function loadUsername() {
    try {
      const res = await fetch('/user/profile');
      const data = await res.json();

      if (res.ok && data.username && data.role) {
        // Capitalize first letter of role
        const roleName = data.role.charAt(0).toUpperCase() + data.role.slice(1);
        document.querySelector('.sidebar-user .user-name').innerText = `${roleName} ${data.username}`;
      } else {
        document.querySelector('.sidebar-user .user-name').innerText = 'Unknown User';
      }
    } catch (err) {
      console.error('Failed to load user info:', err);
      document.querySelector('.sidebar-user .user-name').innerText = 'Error';
    }
  }

  loadUsername();
</script>

</div>




  <!-- Main Content -->
      <main class="main">
          <section id="dashboard" class="section active">
                  <div class="dashboard-container">
                      <div class="dashboard-header">
                          <h1>Manager Dashboard</h1>
                      </div>
                      <div class="dashboard-grid">
                          <!-- Manager Quick Actions -->
                          <div class="quick-actions-section">
                              <h2>Quick Actions</h2>
                              <div class="quick-actions-grid">
                                  
                                  <button class="quick-action-btn" onclick="showSection('leave-approvals')">
                                      <i class="fas fa-file-signature"></i>
                                      <span>Leave Approvals</span>
                                  </button>
                                  <button class="quick-action-btn" onclick="showSection('employee-directory')">
                                      <i class="fas fa-users"></i>
                                      <span>Employee Directory</span>
                                  </button>
                                  <button class="quick-action-btn" onclick="showSection('reports')">
                                      <i class="fas fa-chart-bar"></i>
                                      <span>Reports</span>
                                  </button>
                              </div>
                          </div>

                          <!-- Manager Overview Section -->
                          <div class="overview-section">
                              <h2>Overview</h2>
                              <div class="overview-stats">
                                  <div class="overview-item">
                                      <span class="overview-label">Total Employees</span>
                                      <span class="overview-number" id="employee-count"></span>
                                  </div>
                                  <div class="overview-item">
                                      <span class="overview-label">Pending Leave Requests</span>
                                      <span class="overview-number" id="pending-leave-count"></span>
                                  </div>
                                  <div class="overview-item">
                                      <span class="overview-label">Attendance Issues</span>
                                      <span class="overview-number">--</span>
                                  </div>
                              </div>
                          </div>
                          <script>
                              async function loadEmployeeCount() {
          try {
              const response = await fetch("/api/users/count");
              const data = await response.json();
              document.getElementById("employee-count").innerText = data.total;
          } catch (error) {
              console.error("Error fetching employee count:", error);
          }
          const response = await fetch("/api/users/count");
  if (!response.ok) {
      console.error("Failed to fetch data, status code:", response.status);
      return;
  }

      }

      async function loadPendingLeaveCount() {
          try {
              const response = await fetch("/api/leave/pending-count");
              const data = await response.json();
              console.log(Object.keys(data)); // To see available keys

              document.getElementById("pending-leave-count").innerText = data.total_pending;
          } catch (error) {
              console.error("Error fetching pending leave count:", error);
          }
      }

    // Call both on page load (use DOMContentLoaded so other handlers aren't overwritten)
    document.addEventListener('DOMContentLoaded', function () {
      loadEmployeeCount();
      loadPendingLeaveCount();
    });
  </script>

    
                          

                          <!-- System Notifications Section -->
                          <div class="notifications-section">
                              <h2>System Notifications</h2>
                              <div class="notifications-list">
                                  <div class="notification-item">
                                      <i class="fas fa-user-plus"></i>
                                      <span>New employees onboarded this month</span>
                                  </div>
                                  <div class="notification-item">
                                      <i class="fas fa-calendar-times"></i>
                                      <span>Upcoming holidays and events</span>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </section>
                          

                         
                      </div>
                  </div>
              </section>

              <!-- Attendance Management Section -->
              <section id="attendance-management" class="section">
                  <div class="section-header">
                      <h1>Attendance Management</h1>
                      <p>View and manage employee attendance records</p>
                  </div>
                  <div class="attendance-management-container">
                      <div class="attendance-management-header">
                          <div class="search-filters">
                              <input type="text" id="attendanceSearch" placeholder="Search by Employee Name or ID...">
                          </div>
                      </div>
                      <div class="attendance-management-table-container">
                          <table class="attendance-management-table">
                              <thead>
                                  <tr>
                                      <th>Employee</th>
                                      <th>Date</th>
                                      <th>Status</th>
                                      <th>Time In</th>
                                      <th>Time Out</th>
                                      <th>Remarks</th>
                                      <th>Action</th>
                                  </tr>
                              </thead>
                              <tbody id="attendanceManagementBody">
                                  <!-- Attendance records will be populated here -->
                              </tbody>
                          </table>
                      </div>
                  </div>
              </section>

              <!-- Leave Approvals Section -->
              

              <section id="leave-approvals" class="section">
                  <div class="section-header">
                      <h1>Leave Approvals</h1>
                      <p>Review and approve/reject leave applications</p>
                  </div>
                  <div class="leave-approvals-container">
                      <div class="leave-approvals-header">
                          <div class="search-filters">
                              <input type="text" id="leaveSearchManager" placeholder="Search by Employee Name, Leave Type or Status...">
                          </div>
                      </div>
                      <div class="leave-approvals-table-container">
                    
    <table id="leaveTable" class="styled-table">
      <thead >
        <tr>
          <th>Employee</th>
          <th>Leave Type</th>
          <th>Dates</th>
          <th>No. of Days</th>
          <th>Reason</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data will be inserted here -->
      </tbody>
    </table>

  <!-- Pagination controls for leave approvals -->
  <div id="leavePagination" class="pagination" style="margin-top:12px; display:flex; gap:8px; align-items:center; justify-content: flex-start;"></div>

    <script>
      const API_URL = "/api/Leaves";

      // Pagination configuration for leave approvals
      const LEAVES_PER_PAGE = 10;
      let leavesDataAll = [];
      let leavesFiltered = [];
      let currentLeavePage = 1;

      async function fetchLeaves() {
        const res = await fetch(API_URL);
        const data = await res.json();
        leavesDataAll = Array.isArray(data) ? data : [];
        leavesFiltered = leavesDataAll.slice();
        currentLeavePage = 1;
        renderLeavesPage(currentLeavePage);
      }

      async function updateStatus(id, status) {
        const res = await fetch(API_URL + "/update", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id, status }),
        });

        const result = await res.json();
        if (result.success) {
          fetchLeaves(); // reload after update
        } else {
          alert(result.message);
        }
      }

      function renderLeavesPage(page = 1) {
        const tbody = document.querySelector("#leaveTable tbody");
        tbody.innerHTML = "";

        const total = leavesFiltered.length;
        const totalPages = Math.max(1, Math.ceil(total / LEAVES_PER_PAGE));
        if (page < 1) page = 1;
        if (page > totalPages) page = totalPages;
        currentLeavePage = page;

        const start = (page - 1) * LEAVES_PER_PAGE;
        const pageItems = leavesFiltered.slice(start, start + LEAVES_PER_PAGE);

        if (pageItems.length === 0) {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td colspan="7" style="text-align:center;color:#666;padding:18px;">No records found.</td>`;
          tbody.appendChild(tr);
        } else {
          pageItems.forEach(leave => {
            let statusClass = '';
            if (leave.status === 'Approved') statusClass = 'status-approved';
            else if (leave.status === 'Rejected') statusClass = 'status-rejected';
            else if (leave.status === 'Pending') statusClass = 'leave-status-pending';


            const tr = document.createElement('tr');
            tr.setAttribute('data-id', leave.id);
            tr.innerHTML = `
              <td>${leave.employeeID}</td>
              <td>${leave.leave_type}</td>
              <td>${formatDate(leave.start_date)} - ${formatDate(leave.end_date)}</td>
              <td>${calculateDays(leave.start_date, leave.end_date)}</td>
              <td>${leave.reason}</td>
              <td><span class="status ${statusClass}">${leave.status}</span></td>
              <td>
                <button class="btn-sanction" onclick="this.disabled=true; this.style.background='#2ecc71'; this.style.cursor='not-allowed'; updateStatus(${leave.id}, 'Approved')" style="background:#27ae60;">Sanction</button>
                <button class="btn-reject" onclick="updateStatus(${leave.id}, 'Rejected')">Reject</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        }

        renderLeavePaginationControls(totalPages);
      }

      function renderLeavePaginationControls(totalPages) {
        const container = document.getElementById('leavePagination');
        if (!container) return;
        container.innerHTML = '';
        const total = leavesFiltered.length;
        if (total === 0) return;

        const prev = document.createElement('button');
        prev.textContent = 'Prev';
        prev.disabled = currentLeavePage === 1;
        prev.onclick = () => renderLeavesPage(currentLeavePage - 1);
        container.appendChild(prev);

        const maxButtons = 7;
        let startPage = 1;
        let endPage = totalPages;
        if (totalPages > maxButtons) {
          const half = Math.floor(maxButtons / 2);
          startPage = Math.max(1, currentLeavePage - half);
          endPage = startPage + maxButtons - 1;
          if (endPage > totalPages) {
            endPage = totalPages;
            startPage = endPage - maxButtons + 1;
          }
        }

        if (startPage > 1) {
          const btn = document.createElement('button');
          btn.textContent = '1';
          btn.className = 'page-number';
          btn.onclick = () => renderLeavesPage(1);
          container.appendChild(btn);
          if (startPage > 2) {
            const dots = document.createElement('span');
            dots.textContent = '...';
            dots.style.margin = '0 6px';
            container.appendChild(dots);
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          const btn = document.createElement('button');
          btn.textContent = String(i);
          btn.className = 'page-number' + (i === currentLeavePage ? ' active' : '');
          btn.onclick = () => renderLeavesPage(i);
          container.appendChild(btn);
        }

        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            const dots = document.createElement('span');
            dots.textContent = '...';
            dots.style.margin = '0 6px';
            container.appendChild(dots);
          }
          const btn = document.createElement('button');
          btn.textContent = String(totalPages);
          btn.className = 'page-number';
          btn.onclick = () => renderLeavesPage(totalPages);
          container.appendChild(btn);
        }

        const next = document.createElement('button');
        next.textContent = 'Next';
        next.disabled = currentLeavePage === totalPages || totalPages === 0;
        next.onclick = () => renderLeavesPage(currentLeavePage + 1);
        container.appendChild(next);

        const info = document.createElement('span');
        info.className = 'page-info';
        const start = (currentLeavePage - 1) * LEAVES_PER_PAGE;
        const from = total === 0 ? 0 : (start + 1);
        const to = Math.min(start + LEAVES_PER_PAGE, total);
        info.textContent = `Showing ${from}-${to} of ${total}`;
        container.appendChild(info);
      }

      function calculateDays(start, end) {
        const startDate = new Date(start);
        const endDate = new Date(end);
        if (isNaN(startDate) || isNaN(endDate)) return 0;
        const diffTime = endDate - startDate;
        return Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        if (isNaN(date)) return dateString;
        return date.toISOString().split("T")[0];
      }

      document.getElementById('leaveSearchManager').addEventListener('keyup', function () {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('#leaveTable tbody tr');
        rows.forEach(row => {
          const rowText = row.textContent.toLowerCase();
          row.style.display = rowText.includes(searchTerm) ? '' : 'none';
        });
      });

      // üîπ Call fetch on page load
      fetchLeaves();
  </script>



<!-- =================== Leave Master Section =================== -->
<section id="leave-master" class="section" style="display: none;">
    <div class="section-header">
        <h1>Leave Master</h1>
        <button type="button" id="backFromModalBtn" class="btn btn-secondary">‚Üê Back</button>
        <button id="addLeaveBalanceBtn" class="btn">+ Add Leave Balance</button>
    </div>

    <table class="styled-table">
        <thead>
            <tr>
                <th>EMPLOYEE ID</th>
                <th>LEAVE TYPE</th>
                <th>LEAVE DESCRIPTION</th>
                <th>BALANCE</th>
                <th>ACTION</th>
            </tr>
        </thead>
        <tbody id="leaveMasterTableBody">
            <!-- Example row, later replace with backend data -->
            <tr>
                <td>EMP001</td>
                <td>Casual Leave (CL)</td>
                <td>Casual leave for personal reasons</td>
                <td>10</td>
                <td><button class="btn btn-edit">Edit</button></td>
            </tr>
        </tbody>
    </table>
</section>

<style>
  /* =================== Professional Styling for Add Leave Balance Modal =================== */
#addLeaveBalanceModal {
    display: none; /* hidden by default */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5); /* semi-transparent background */
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

#addLeaveBalanceModal .modal-content {
    background-color: #fff;
    margin: 6% auto;
    padding: 30px 40px;
    border-radius: 10px;
    max-width: 500px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    position: relative;
    transition: all 0.3s ease;
}

#addLeaveBalanceModal .close {
    position: absolute;
    top: 15px;
    right: 20px;
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s ease;
}

#addLeaveBalanceModal .close:hover {
    color: #000;
}

#addLeaveBalanceModal h2 {
    margin-bottom: 5px;
    color: #333;
    font-weight: 600;
}

#addLeaveBalanceModal p {
    margin-bottom: 20px;
    color: #666;
    font-size: 14px;
}

/* Form styling */
#addLeaveBalanceModal form label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #333;
}

#addLeaveBalanceModal form input[type="text"],
#addLeaveBalanceModal form input[type="number"] {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.2s ease;
}

#addLeaveBalanceModal form input[type="text"]:focus,
#addLeaveBalanceModal form input[type="number"]:focus {
    border-color: #007BFF;
    outline: none;
}

/* Leave Type Buttons */
#addLeaveBalanceModal .leave-type-options {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
}

#addLeaveBalanceModal .leave-type-options label {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 20px;
    border: 1px solid #007BFF;
    border-radius: 8px;
    background-color: #f9f9f9;
    color: #007BFF;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    user-select: none;
    min-width: 120px;
    text-align: center;
}

#addLeaveBalanceModal .leave-type-options label:hover {
    background-color: #e0f0ff;
}

#addLeaveBalanceModal .leave-type-options input[type="radio"] {
    display: none;
}

#addLeaveBalanceModal .leave-type-options input[type="radio"]:checked + span {
    background-color: #004A7C;
    color: #fff;
    border-color: #0056b3;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    border-radius: 8px;
}

/* Form buttons */
#addLeaveBalanceModal .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

#addLeaveBalanceModal .form-actions .btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

#addLeaveBalanceModal .form-actions .btn:hover {
    opacity: 0.9;
}

#addLeaveBalanceModal .form-actions .btn-secondary {
    background-color: #ccc;
    color: #333;
}

#addLeaveBalanceModal .form-actions .btn {
    background-color: #004A7C;
    color: #fff;
}

</style>

<!-- =================== Leave Master Section =================== -->
<section id="leave-master" class="section" style="display: none;">
    <div class="section-header">
      <span class="close" id="closeLeaveBalanceModal">&times;</span>
        <h1>Leave Master</h1>
        <button id="addLeaveBalanceBtn" class="btn">+ Add Leave Balance</button>
       
    </div>

    <table class="styled-table">
        <thead>
            <tr>
                <th>EMPLOYEE ID</th>
                <th>LEAVE TYPE</th>
                <th>LEAVE DESCRIPTION</th>
                <th>BALANCE</th>
                <th>ACTION</th>
            </tr>
        </thead>
        <tbody id="leaveMasterTableBody">
            <tr>
                <td>EMP001</td>
                <td>Casual Leave (CL)</td>
                <td>Casual leave for personal reasons</td>
                <td>10</td>
                <td><button class="btn btn-edit">Edit</button></td>
            </tr>
        </tbody>
    </table>
</section>
<!-- =================== Modal for Adjust Leave Balance =================== -->
<div id="addLeaveBalanceModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" id="closeLeaveBalanceModal">&times;</span>
        <h2>Adjust Leave Balance</h2>
        <p style="color: gray; font-size: 14px;">Add or update leave balances for an employee.</p>

        <form id="leaveBalanceForm">
            <!-- Employee ID -->
            <label for="leaveBalanceEmployeeId">Employee ID</label>
            <input type="text" id="leaveBalanceEmployeeId" name="employeeId" placeholder="e.g. EMP12345" required>

            <!-- Leave Type -->
            <label>Leave Type</label>
            <div class="leave-type-options">
    <label>
        <input type="radio" name="leaveType" value="CL" required>
        <span>Casual (CL)</span>
    </label>
    <label>
        <input type="radio" name="leaveType" value="EL">
        <span>Earned (EL)</span>
    </label>
    <label>
        <input type="radio" name="leaveType" value="HL">
        <span>Hospital (HL)</span>
    </label>
</div>


            <!-- Balance -->
            <label for="balance">Balance</label>
            <input type="number" id="balance" name="balance" placeholder="e.g. 10" required>

            <!-- Buttons -->
            <div class="form-actions">
                <button type="button" id="backFromModalBtn" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn">Submit</button>
            </div>
        </form>
    </div>
</div>



<!-- =================== JS Functionality =================== -->
<script>
    const showLeaveMasterBtn = document.getElementById("showLeaveMasterBtn");
const leaveMasterSection = document.getElementById("leave-master");
const leaveApprovalsSection = document.getElementById("leave-approvals");

const addLeaveBalanceBtn = document.getElementById("addLeaveBalanceBtn");
const addLeaveBalanceModal = document.getElementById("addLeaveBalanceModal");
const closeLeaveBalanceModal = document.getElementById("closeLeaveBalanceModal");
const backFromModalBtn = document.getElementById("backFromModalBtn");

// Toggle Leave Approvals and Leave Master
showLeaveMasterBtn.addEventListener("click", () => {
    leaveApprovalsSection.style.display = "none";
    leaveMasterSection.style.display = "block";
    window.scrollTo(0, leaveMasterSection.offsetTop);
});

// Open Add Leave Balance Modal
addLeaveBalanceBtn.addEventListener("click", () => {
    addLeaveBalanceModal.style.display = "block";
});

// Close Modal
closeLeaveBalanceModal.addEventListener("click", () => {
    addLeaveBalanceModal.style.display = "none";
});

// Close modal when clicking outside
window.addEventListener("click", (e) => {
    if (e.target === addLeaveBalanceModal) {
        addLeaveBalanceModal.style.display = "none";
    }
});

// Form Submit (Frontend only for now)
document.getElementById("leaveBalanceForm").addEventListener("submit", function(e) {
    e.preventDefault();
    alert("Leave Balance Added (connect to backend API here).");
    addLeaveBalanceModal.style.display = "none";
});

// Back from Modal ‚Üí Go to Leave Approvals
backFromModalBtn.addEventListener("click", () => {
    addLeaveBalanceModal.style.display = "none";   // Close modal
    leaveMasterSection.style.display = "none";     // Hide Leave Master
    leaveApprovalsSection.style.display = "block"; // Show Leave Approvals
});



//------------


</script>



    <!-- TEST -->
  </section>
  
            <!-- Attendance Section -->
            <section id="attendance" class="section">
                <!-- Employee View -->
                <div id="attendance-employee" class="attendance-employee">
                    <div class="attendance-hero">
                        <h1>Mark Your Attendance</h1>
                        <p>Welcome back! Please clock in to start your day.</p>
                    </div>
                    <div class="attendance-clock">
                        <span class="clock-label">Current Date & Time</span>
                        <div id="liveDateTime" class="clock-display">--</div>
                      <div class="clock-actions">
                        <button id="btnClockIn" class="btn clock-btn" aria-pressed="false">
                          <i class="fas fa-play-circle"></i> Clock In
                        </button>
                        <button id="btnClockOut" class="btn clock-btn secondary" aria-pressed="false">
                          <i class="fas fa-stop-circle"></i> Clock Out
                        </button>
                      </div>

                      <script>
                      (function () {
                        const BTN_IN_KEY = 'am_active';
                        const LAST_IN_KEY = 'am_lastClockIn';

                        const btnIn = document.getElementById('btnClockIn');
                        const btnOut = document.getElementById('btnClockOut');
                        const lastClockInEl = () => document.getElementById('lastClockIn');

                        function setButtonsState(active) {
                          btnIn.disabled = !!active;
                          btnOut.disabled = !active;
                          btnIn.setAttribute('aria-pressed', active ? 'true' : 'false');
                          btnOut.setAttribute('aria-pressed', active ? 'true' : 'false');
                        }

                        function restoreFromStorage() {
                          const active = localStorage.getItem(BTN_IN_KEY) === '1';
                          // Show lastClockIn only when active; otherwise clear display
                          if (active) {
                            const ts = localStorage.getItem(LAST_IN_KEY);
                            if (ts && lastClockInEl()) lastClockInEl().innerText = new Date(ts).toLocaleString();
                          } else {
                            if (lastClockInEl()) lastClockInEl().innerText = '--';
                          }
                          setButtonsState(active);
                        }

                        btnIn.addEventListener('click', async function () {
                          // call existing global clockIn (defined elsewhere)
                          try {
                            await (typeof clockIn === 'function' ? clockIn() : Promise.reject('clockIn not defined'));
                            // mark active and persist last clock-in timestamp (use server-provided display if available,
                            // but store current ISO as canonical)
                            const nowISO = new Date().toISOString();
                            localStorage.setItem(BTN_IN_KEY, '1');
                            localStorage.setItem(LAST_IN_KEY, nowISO);

                            // Ensure UI shows readable time (server handler already updates lastClockIn, but fallback to now)
                            if (lastClockInEl() && (lastClockInEl().innerText === '--' || !lastClockInEl().innerText)) {
                              lastClockInEl().innerText = new Date(nowISO).toLocaleString();
                            }
                            setButtonsState(true);
                          } catch (err) {
                            console.error('Clock In failed:', err);
                          }
                        });

                        btnOut.addEventListener('click', async function () {
                          try {
                            await (typeof clockOut === 'function' ? clockOut() : Promise.reject('clockOut not defined'));
                            // clear active state and remove persisted last clock-in so on refresh it will be empty
                            localStorage.removeItem(BTN_IN_KEY);
                            localStorage.removeItem(LAST_IN_KEY);

                            if (lastClockInEl()) lastClockInEl().innerText = '--';
                            setButtonsState(false);
                          } catch (err) {
                            console.error('Clock Out failed:', err);
                          }
                        });

                        // Ensure state set after DOM ready (lastClockIn element may appear later)
                        if (document.readyState === 'loading') {
                          document.addEventListener('DOMContentLoaded', restoreFromStorage);
                        } else {
                          restoreFromStorage();
                        }
                      })();
                      </script>
                        
                       
             
                       
                    
                

                    <div class="attendance-summary">
                        <h2>Today's Summary</h2>
                        <div class="summary-row">
                            <div class="summary-item">
                              <i class="fas fa-sign-in-alt"></i>
                              <div>
                                <div class="summary-label">Last Clock In</div>
                                <div id="lastClockIn" class="summary-value">--</div>
                              </div>
                            </div>
                            <div class="summary-item">
                              <i class="fas fa-sign-out-alt"></i>
                              <div>
                                <div class="summary-label">Last Clock Out</div>
                                <div id="lastClockOut" class="summary-value">--</div>
                              </div>
                            </div>
                            <script>
                              async function loadSummary() {
                                const res = await fetch('/summary');
                                const data = await res.json();

                                if (data.start_time) {
                                  document.getElementById('lastClockIn').innerText =
                                    new Date(data.start_time).toLocaleString();
                                }
                                if (data.end_time) {
                                  document.getElementById('lastClockOut').innerText =
                                    new Date(data.end_time).toLocaleString();
                                }
                                if (data.hours_worked !== null) {
                                  document.getElementById('hoursWorked').innerText = formatHoursMinutes(data.hours_worked);
                                }
                              }
                            </script>
                            <div class="summary-item">
                                <i class="fas fa-hourglass-half"></i>
                                <div>
                                    <div class="summary-label">Hours Worked Today</div>
                                    <div id="hoursWorked" class="summary-value">0 hours 0 minutes</div>
                                </div>
                            </div>
                        </div>
                        <div class="attendance-links">
                            <a href="#" onclick="showMyAttendanceReport()">My Attendance Report</a>
                        </div>
                    </div>
                    <!-- Today's Log (moved into attendance area) -->
                    <div class="attendance-todays-log">
                      <div class="modern-card">
                        <h3 style="margin:0 0 8px 0; font-size:16px; color:#0b3b5a;">Today's Log</h3>
                        <table id="todaysLogTable" class="styled-table" style="margin-top:8px; width:100%;">
                          <thead>
                            <tr>
                              <th>Clock In</th>
                              <th>Clock Out</th>
                              <th>Working Hours</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr><td colspan="3" style="text-align:center;color:#666;padding:12px;">Loading...</td></tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                </div>
            </section>
            <script>
            // Helper: format hours_worked numeric (hours, possibly fractional) into "X hour(s) Y minute(s)"
            function formatHoursMinutes(value) {
              if (value === null || value === undefined || value === '') return '‚Äî';
              const num = Number(value);
              if (isNaN(num)) return String(value);
              let hours = Math.floor(Math.abs(num));
              let minutes = Math.round((Math.abs(num) - hours) * 60);
              if (minutes === 60) { hours += 1; minutes = 0; }
              const hourLabel = hours === 1 ? 'hour' : 'hours';
              const minuteLabel = minutes === 1 ? 'minute' : 'minutes';
              // Preserve sign if negative (unlikely for worked hours but safe)
              const sign = num < 0 ? '-' : '';
              return `${sign}${hours} ${hourLabel} ${minutes} ${minuteLabel}`;
            }

async function clockIn() {
  const res = await fetch('/clockin', { method: 'POST' });
  const data = await res.json();

  if (res.status === 400 || data.error) {
    alert(data.error || "Clock In failed");
    return;
  }

  document.getElementById('lastClockIn').innerText =
    new Date(data.start_time).toLocaleString();
  loadSummary();
  // refresh today's log
  loadTodaysLog();
}

async function clockOut() {
  const res = await fetch('/clockout', { method: 'POST' });
  const data = await res.json();

  if (res.status === 400 || data.error) {
    alert(data.error || "Clock Out failed");
    return;
  }

  if (data.end_time) {
    document.getElementById('lastClockOut').innerText =
      new Date(data.end_time).toLocaleString();
  }
  if (data.hours_worked !== null) {
    document.getElementById('hoursWorked').innerText = formatHoursMinutes(data.hours_worked);
  }
  loadSummary();
  // refresh today's log
  loadTodaysLog();
}

async function loadSummary() {
  const res = await fetch('/summary');
  const data = await res.json();

  if (data.start_time) {
    document.getElementById('lastClockIn').innerText =
      new Date(data.start_time).toLocaleString();
  }
  if (data.end_time) {
    document.getElementById('lastClockOut').innerText =
      new Date(data.end_time).toLocaleString();
  }
  if (data.hours_worked !== null) {
    document.getElementById('hoursWorked').innerText = formatHoursMinutes(data.hours_worked);
  }
}

// Load latest summary on page load
loadSummary();
// Load today's log on page load
document.addEventListener('DOMContentLoaded', loadTodaysLog);

// Fetch and render today's attendance entries
async function loadTodaysLog() {
  const table = document.getElementById('todaysLogTable');
  if (!table) return;
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:#666;padding:12px;">Loading...</td></tr>';
  try {
    const res = await fetch('/api/attendance');
    if (!res.ok) {
      tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;color:#c00;padding:12px;">Error: ${res.status} ${res.statusText}</td></tr>`;
      return;
    }
    const rows = await res.json();
    if (!Array.isArray(rows) || rows.length === 0) {
      tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:#666;padding:12px;">No logs for today</td></tr>';
      return;
    }
    tbody.innerHTML = '';
    rows.forEach(r => {
      const inTime = r.start_time ? new Date(r.start_time).toLocaleString() : '‚Äî';
      const outTime = r.end_time ? new Date(r.end_time).toLocaleString() : '‚Äî';
      const hours = (r.hours_worked !== null && r.hours_worked !== undefined) ? formatHoursMinutes(r.hours_worked) : '‚Äî';
      // Store the raw hours_worked value to the attendance table (if needed)
      // Example: send to backend or update a hidden field (pseudo-code, adjust as needed)
      // await fetch('/api/attendance/update-hours', { method: 'POST', body: JSON.stringify({ id: r.id, hours_worked: r.hours_worked }) });

      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${inTime}</td><td>${outTime}</td><td>${hours}</td>`;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error('Error fetching today\'s log:', err);
    tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;color:#c00;padding:12px;">Error loading logs</td></tr>`;
  }
}
</script>



           


    <style>
.report-form {
  background: #fff;
  padding: 30px;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  max-width: 850px;
  margin: 20px auto;
  font-family: "Segoe UI", Arial, sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.section-header h1 {
  margin-bottom: 5px;
  font-size: 24px;
  font-weight: 600;
  color: #333;
}

.section-header p {
  margin-bottom: 20px;
  color: #777;
}

h3 {
  margin-top: 25px;
  margin-bottom: 8px;
  font-size: 18px;
  font-weight: 600;
  color: #444;
}

p {
  margin: 0 0 15px 0;
  color: #666;
  font-size: 14px;
}

.report-type-row {
  display: flex;
  gap: 20px;
  margin-bottom: 25px;
}
.report-option {
  flex: 1;
  border: 2px solid #ddd;
  border-radius: 10px;
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  transition: 0.2s ease;
  background: #fafafa;
  white-space: nowrap; /*  prevents text from wrapping */
}

.report-option span {
  font-size: 15px;
  font-weight: 500;
  color: #333;
}

.report-option:hover {
  border-color: #007bff;
  background: #f0f8ff;
}

.report-option input {
  accent-color: #007bff;
  transform: scale(1.2);
}

  /* Professional two-column form layout for report parameters */
  .parameters-grid {
    display: grid;
    grid-template-columns: 180px 1fr; /* label column + field column */
    gap: 12px 22px;
    align-items: center;
    margin-bottom: 20px;
    background: linear-gradient(180deg,#ffffff 0%, #fbfdff 100%);
    padding: 14px;
    border-radius: 10px;
    border: 1px solid rgba(15,42,71,0.06);
    box-shadow: 0 6px 20px rgba(10,25,47,0.04);
  }

  /* Right-align labels so fields align in a neat column */
  .parameters-grid label {
    justify-self: end;
    margin: 0;
    font-weight: 700;
    color: #1f2937;
    font-size: 14px;
    padding-right: 6px;
  }

  /* Inputs and selects: roomy, subtle border, good focus state */
  .parameters-grid input,
  .parameters-grid select,
  .parameters-grid textarea {
    width: 100%;
    padding: 10px 12px;
    font-size: 14px;
    border: 1px solid #e6e9ef;
    border-radius: 8px;
    background: #fbfdff;
    transition: box-shadow 160ms ease, border-color 160ms ease;
  }

  .parameters-grid input:focus,
  .parameters-grid select:focus,
  .parameters-grid textarea:focus {
    border-color: #3a86ff;
    box-shadow: 0 6px 18px rgba(58,134,255,0.10);
    outline: none;
  }

  /* Utility: make a field take full row under the labels (useful for Department or wide controls) */
  .parameters-grid .full-width {
    grid-column: 1 / -1;
    display: flex;
    gap: 12px;
    align-items: center;
  }

  /* If you want the department select to span the full width under the labels, it will do so automatically */
  .parameters-grid select#department {
    grid-column: 1 / -1;
    max-width: 560px; /* keep it readable */
  }

  /* Responsive: stack on narrow screens */
  @media (max-width: 720px) {
    .parameters-grid {
      grid-template-columns: 1fr;
      gap: 10px;
      padding: 12px;
    }
    .parameters-grid label { justify-self: start; }
    .parameters-grid .full-width { grid-column: 1 / -1; }
    .parameters-grid select#department { grid-column: 1 / -1; max-width: 100%; }
  }

.form-footer {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 20px;
  margin-top: 20px;
}

.form-footer span {
  color: #555;
  font-weight: 600;
}

.btn-generate {
  background: #007bff;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
  border-radius: 6px;
  color: #fff;
  font-size: 15px;
  font-weight: 500;
  transition: background 0.2s ease;
}

.btn-generate:hover {
  background: #0056b3;
}
</style>

<!-- Improved styling for generated reports: wider, readable table and single-line date range -->

<style>
.report-form {
  background: #fff;
  padding: 100px;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  max-width: 10000px;
  margin: 20px auto;
  font-family: "Segoe UI", Arial, sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.section-header h1 {
  margin-bottom: 5px;
  font-size: 24px;
  font-weight: 600;
  color: #333;
}

.section-header p {
  margin-bottom: 20px;
  color: #777;
}

h3 {
  margin-top: 25px;
  margin-bottom: 8px;
  font-size: 18px;
  font-weight: 600;
  color: #444;
}

p {
  margin: 0 0 15px 0;
  color: #666;
  font-size: 14px;
}

.report-type-row {
  display: flex;
  gap: 20px;
  margin-bottom: 25px;
}
.report-option {
  flex: 1;
  border: 2px solid #ddd;
  border-radius: 10px;
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  transition: 0.2s ease;
  background: #fafafa;
  white-space: nowrap; /*  prevents text from wrapping */
}

.report-option span {
  font-size: 15px;
  font-weight: 500;
  color: #333;
}

.report-option:hover {
  border-color: #007bff;
  background: #f0f8ff;
}

.report-option input {
  accent-color: #007bff;
  transform: scale(1.2);
}

.parameters-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px 40px;
  margin-bottom: 25px;
}

.parameters-grid label {
  display: block;
  font-weight: 600;
  margin-bottom: 6px;
  font-size: 14px;
  color: #333;
}

.parameters-grid input,
.parameters-grid select {
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 6px;
  transition: border-color 0.2s ease;
}

.parameters-grid input:focus,
.parameters-grid select:focus {
  border-color: #007bff;
  outline: none;
}

.form-footer {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 20px;
  margin-top: 20px;
}

.form-footer span {
  color: #555;
  font-weight: 600;
}

.btn-generate {
  background: #007bff;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
  border-radius: 6px;
  color: #fff;
  font-size: 15px;
  font-weight: 500;
  transition: background 0.2s ease;
}

.btn-generate:hover {
  background: #0056b3;
}
</style>

<!-- Improved styling for generated reports: wider, readable table and single-line date range -->
<style>/* Report container - full width, responsive */
#reportTableContainer {
  width: 120%;
  margin: 20px auto;
  padding: 0 20px;
  overflow-x: visible; /* allow full display */
}

/* Title styling */
#reportTableContainer h3 {
  margin: 8px 0 6px;
  font-size: 20px;
  color: #222;
  font-weight: 600;
}

/* Meta info line */
#reportTableContainer > p {
  margin: 0 0 12px;
  color: #555;
  font-size: 14px;
  display: flex;
  gap: 12px;
  flex-wrap: wrap; /* allow wrapping on small screens */
  white-space: normal;
  align-items: center;
}

/* Table styling - full width and responsive */
#reportTableContainer .styled-table {
  width: 100%;
  border-collapse: collapse;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
  color: #333;
  background: #fff;
  box-shadow: 0 6px 18px rgba(13,38,76,0.06);
  border-radius: 8px;
  table-layout: auto; /* let columns size naturally */
}

/* Table head */
#reportTableContainer .styled-table thead th {
  background: linear-gradient(180deg, #f8fafc 0%, #f4f6f9 100%);
  color: #213547;
  font-weight: 700;
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid #e6e9ef;
  position: sticky;
  top: 0;
  z-index: 2;
}

/* Table body */
#reportTableContainer .styled-table tbody td {
  padding: 12px 16px;
  border-bottom: 1px solid #f1f4f8;
  vertical-align: middle;
}

/* Highlight first column */
#reportTableContainer .styled-table tbody td:first-child {
  font-weight: 600;
  color: #0b63d4;
  white-space: nowrap;
}

/* Row hover effect */
#reportTableContainer .styled-table tbody tr:hover {
  background: #fbfdff;
}

/* Pagination styling */
#reportPagination {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 12px;
}

#reportPagination .page-info {
  margin-left: 12px;
  color: #666;
  font-size: 13px;
}

/* No records message styling */
#reportTableContainer .no-records {
  text-align: center;
  color: #777;
  padding: 18px;
}

/* Responsive: handle small screens */
@media (max-width: 768px) {
  #reportTableContainer {
    padding: 0 10px;
  }

  #reportTableContainer .styled-table {
    font-size: 13px;
  }

  #reportTableContainer > p {
    flex-direction: column;
    align-items: flex-start;
  }
}
</style>



            
<!-- Reports Section -->
<style>
.report-form {
  background: #fff;
  padding: 100px;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  max-width: 10000px;
  margin: 20px auto;
  font-family: "Segoe UI", Arial, sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.section-header h1 {
  margin-bottom: 5px;
  font-size: 24px;
  font-weight: 600;
  color: #333;
}

.section-header p {
  margin-bottom: 20px;
  color: #777;
}

h3 {
  margin-top: 25px;
  margin-bottom: 8px;
  font-size: 18px;
  font-weight: 600;
  color: #444;
}

p {
  margin: 0 0 15px 0;
  color: #666;
  font-size: 14px;
}

.report-type-row {
  display: flex;
  gap: 20px;
  margin-bottom: 25px;
}
.report-option {
  flex: 1;
  border: 2px solid #ddd;
  border-radius: 10px;
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  transition: 0.2s ease;
  background: #fafafa;
  white-space: nowrap; /*  prevents text from wrapping */
}

.report-option span {
  font-size: 15px;
  font-weight: 500;
  color: #333;
}

.report-option:hover {
  border-color: #007bff;
  background: #f0f8ff;
}

.report-option input {
  accent-color: #007bff;
  transform: scale(1.2);
}

.parameters-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px 40px;
  margin-bottom: 25px;
}

.parameters-grid label {
  display: block;
  font-weight: 600;
  margin-bottom: 6px;
  font-size: 14px;
  color: #333;
}

.parameters-grid input,
.parameters-grid select {
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 6px;
  transition: border-color 0.2s ease;
}

.parameters-grid input:focus,
.parameters-grid select:focus {
  border-color: #007bff;
  outline: none;
}

.form-footer {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 20px;
  margin-top: 20px;
}

.form-footer span {
  color: #555;
  font-weight: 600;
}

.btn-generate {
  background: #007bff;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
  border-radius: 6px;
  color: #fff;
  font-size: 15px;
  font-weight: 500;
  transition: background 0.2s ease;
}

.btn-generate:hover {
  background: #0056b3;
}
</style>

<!-- Improved styling for generated reports: wider, readable table and single-line date range -->
<style>/* Report container - full width, responsive */
#reportTableContainer {
  width: 120%;
  margin: 20px auto;
  padding: 0 20px;
  overflow-x: visible; /* allow full display */
}

/* Title styling */
#reportTableContainer h3 {
  margin: 8px 0 6px;
  font-size: 20px;
  color: #222;
  font-weight: 600;
}

/* Meta info line */
#reportTableContainer > p {
  margin: 0 0 12px;
  color: #555;
  font-size: 14px;
  display: flex;
  gap: 12px;
  flex-wrap: wrap; /* allow wrapping on small screens */
  white-space: normal;
  align-items: center;
}

/* Table styling - full width and responsive */
#reportTableContainer .styled-table {
  width: 100%;
  border-collapse: collapse;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
  color: #333;
  background: #fff;
  box-shadow: 0 6px 18px rgba(13,38,76,0.06);
  border-radius: 8px;
  table-layout: auto; /* let columns size naturally */
}

/* Table head */
#reportTableContainer .styled-table thead th {
  background: linear-gradient(180deg, #f8fafc 0%, #f4f6f9 100%);
  color: #213547;
  font-weight: 700;
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid #e6e9ef;
  position: sticky;
  top: 0;
  z-index: 2;
}

/* Table body */
#reportTableContainer .styled-table tbody td {
  padding: 12px 16px;
  border-bottom: 1px solid #f1f4f8;
  vertical-align: middle;
}

/* Highlight first column */
#reportTableContainer .styled-table tbody td:first-child {
  font-weight: 600;
  color: #0b63d4;
  white-space: nowrap;
}

/* Row hover effect */
#reportTableContainer .styled-table tbody tr:hover {
  background: #fbfdff;
}

/* Pagination styling */
#reportPagination {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 12px;
}

#reportPagination .page-info {
  margin-left: 12px;
  color: #666;
  font-size: 13px;
}

/* No records message styling */
#reportTableContainer .no-records {
  text-align: center;
  color: #777;
  padding: 18px;
}

/* Responsive: handle small screens */
@media (max-width: 768px) {
  #reportTableContainer {
    padding: 0 10px;
  }

  #reportTableContainer .styled-table {
    font-size: 13px;
  }

  #reportTableContainer > p {
    flex-direction: column;
    align-items: flex-start;
  }
}
</style>

<!-- REPORT SECTION -->
 
    <style>
.report-form {
  background: #fff;
  padding: 100px;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  max-width: 10000px;
  margin: 20px auto;
  font-family: "Segoe UI", Arial, sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.section-header h1 {
  margin-bottom: 5px;
  font-size: 24px;
  font-weight: 600;
  color: #333;
}

.section-header p {
  margin-bottom: 20px;
  color: #777;
}

h3 {
  margin-top: 25px;
  margin-bottom: 8px;
  font-size: 18px;
  font-weight: 600;
  color: #444;
}

p {
  margin: 0 0 15px 0;
  color: #666;
  font-size: 14px;
}

.report-type-row {
  display: flex;
  gap: 20px;
  margin-bottom: 25px;
}
.report-option {
  flex: 1;
  border: 2px solid #ddd;
  border-radius: 10px;
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  transition: 0.2s ease;
  background: #fafafa;
  white-space: nowrap; /*  prevents text from wrapping */
}

.report-option span {
  font-size: 15px;
  font-weight: 500;
  color: #333;
}

.report-option:hover {
  border-color: #007bff;
  background: #f0f8ff;
}

.report-option input {
  accent-color: #007bff;
  transform: scale(1.2);
}

.parameters-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px 40px;
  margin-bottom: 25px;
}

.parameters-grid label {
  display: block;
  font-weight: 600;
  margin-bottom: 6px;
  font-size: 14px;
  color: #333;
}

.parameters-grid input,
.parameters-grid select {
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 6px;
  transition: border-color 0.2s ease;
}

.parameters-grid input:focus,
.parameters-grid select:focus {
  border-color: #007bff;
  outline: none;
}

.form-footer {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 20px;
  margin-top: 20px;
}

.form-footer span {
  color: #555;
  font-weight: 600;
}

.btn-generate {
  background: #007bff;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
  border-radius: 6px;
  color: #fff;
  font-size: 15px;
  font-weight: 500;
  transition: background 0.2s ease;
}

.btn-generate:hover {
  background: #0056b3;
}
</style>

<!-- Improved styling for generated reports: wider, readable table and single-line date range -->
<style>/* Report container - full width, responsive */
#reportTableContainer {
  width: 100%;
  margin: 20px auto;
  padding: 0 20px;
  overflow-x: visible; /* allow full display */
}

/* Title styling */
#reportTableContainer h3 {
  margin: 8px 0 6px;
  font-size: 20px;
  color: #222;
  font-weight: 600;
}

/* Meta info line */
#reportTableContainer > p {
  margin: 0 0 12px;
  color: #555;
  font-size: 14px;
  display: flex;
  gap: 12px;
  flex-wrap: wrap; /* allow wrapping on small screens */
  white-space: normal;
  align-items: center;
}

/* Table styling - full width and responsive */
#reportTableContainer .styled-table {
  width: 100%;
  border-collapse: collapse;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
  color: #333;
  background: #fff;
  box-shadow: 0 6px 18px rgba(13,38,76,0.06);
  border-radius: 8px;
  table-layout: auto; /* let columns size naturally */
}

/* Table head */
#reportTableContainer .styled-table thead th {
  background: linear-gradient(180deg, #f8fafc 0%, #f4f6f9 100%);
  color: #213547;
  font-weight: 700;
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid #e6e9ef;
  position: sticky;
  top: 0;
  z-index: 2;
}

/* Table body */
#reportTableContainer .styled-table tbody td {
  padding: 12px 16px;
  border-bottom: 1px solid #f1f4f8;
  vertical-align: middle;
}

/* Highlight first column */
#reportTableContainer .styled-table tbody td:first-child {
  font-weight: 600;
  color: #0b63d4;
  white-space: nowrap;
}

/* Row hover effect */
#reportTableContainer .styled-table tbody tr:hover {
  background: #fbfdff;
}

/* Pagination styling */
#reportPagination {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 12px;
}

#reportPagination .page-info {
  margin-left: 12px;
  color: #666;
  font-size: 13px;
}

/* No records message styling */
#reportTableContainer .no-records {
  text-align: center;
  color: #777;
  padding: 18px;
}

/* Responsive: handle small screens */
@media (max-width: 768px) {
  #reportTableContainer {
    padding: 0 10px;
  }

  #reportTableContainer .styled-table {
    font-size: 13px;
  }

  #reportTableContainer > p {
    flex-direction: column;
    align-items: flex-start;
  }
}
</style>



            
<!-- Reports Section -->

<!-- Reports Section -->
<section id="reports" class="section">
    <form id="reportForm" class="report-form">
      <div class="section-header">
        <h1>Generate Reports</h1>
        <p>Create detailed attendance and leave reports for your team.</p>
      </div>
      <!-- Report Type -->
      <h3>Report Type</h3>
      
      <p>Choose the type of report you'd like to generate.</p>
      <div class="report-type-row">
        <label class="report-option">
          <input type="radio" name="reportType" value="attendance" checked>
          <span>Attendance Report</span>
        </label>

        <label class="report-option">
          <input type="radio" name="reportType" value="leave">
          <span>Leave Summary Report</span>
        </label>
      </div>

      <!-- Parameters -->
      <h3>Parameters</h3>
      <p>Specify parameters to filter your report.</p>
      <div class="parameters-grid">
        
        <div>
          <label for="department">Department</label>
          <select id="department" name="department">
            <option value="all">All Departments</option>
            <option value="HR">HR</option>
            <option value="IT">IT</option>
            <option value="Finance">Finance</option>
          </select>
        </div>

        <div>
          <label for="employeeId">Select Employee ID</label>
          <select id="employeeId" name="employeeId" required>
            <option value="" disabled selected>Select Employee ID</option>
          </select>
        </div>

        <div>
          <label for="startDate">Start Date</label>
          <input type="date" id="startDate" name="startDate" value="2025-01-01">
        </div>

        <div>
          <label for="endDate">End Date</label>
          <input type="date" id="endDate" name="endDate" value="2025-11-10">
        </div>
      </div>

      <!-- Generate Button -->
      <div class="form-footer">
        <button type="button" class="btn-generate" id="exportExcelBtn" style="background:#28a745;">Export</button>
        <button type="submit" class="btn-generate">Generate Report</button>
      </div>

      <!-- Table will appear here -->
      <div id="reportTableContainer" style="margin-top: 20px;"></div>

    </form>

</section>



       
<script>
  (function () {
    async function loadEmployeeIds() {
      const dropdown = document.getElementById('employeeId');
      if (!dropdown) return;

      // Show temporary loading option
      dropdown.innerHTML = `<option value="" disabled selected>Loading...</option>`;

      try {
        const res = await fetch('/api/userids');
        if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);

        const data = await res.json();
        console.log('Employee IDs fetched:', data);

        // Reset dropdown with placeholder and "All Employees" option
        dropdown.innerHTML = `
          <option value="" disabled selected>Select Employee ID</option>
          <option value="All Employees">All Employees</option>
        `;

        if (!Array.isArray(data) || data.length === 0) {
          throw new Error('No data received');
        }

        // Handle string or object array
        data.forEach(entry => {
          let id = typeof entry === 'string'
            ? entry
            : entry.userid || entry.user_id || entry.id || Object.values(entry)[0];

          if (id) {
            const option = document.createElement('option');
            option.value = id;
            option.innerText = id;
            dropdown.appendChild(option);
          }
        });

      } catch (err) {
        console.error('Error loading employee IDs:', err.message);
        // Fallback: sample IDs
        populateSampleIds(dropdown, err.message);
      }
    }

    function populateSampleIds(dropdown, message) {
      dropdown.innerHTML = `
        <option value="" disabled selected>Select Employee ID</option>
        <option value="All Employees">All Employees</option>
      `;
      const samples = ['EMP01', 'EMP02', 'EMP03', 'EMP04', 'EMP05'];
      samples.forEach(id => {
        const option = document.createElement('option');
        option.value = id;
        option.innerText = id + ' (sample)';
        dropdown.appendChild(option);
      });
      const info = document.createElement('option');
      info.disabled = true;
      info.textContent = `‚ö† ${message || 'Using fallback sample data'}`;
      dropdown.appendChild(info);
    }

    // Run on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadEmployeeIds);
    } else {
      loadEmployeeIds();
    }
  })();
</script>




<script>
  // Client-side pagination for generated reports
  const REPORTS_PER_PAGE = 10;
  let reportsDataAll = [];
  let currentReportPage = 1;

  // Helper: format ISO or Date-like values to dd-mm-yyyy
  function formatToDDMMYYYY(input) {
    if (input === null || input === undefined || input === '') return '';
    // If Date object
    if (input instanceof Date) {
      const d = input;
      const dd = String(d.getDate()).padStart(2, '0');
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const yyyy = d.getFullYear();
      return `${dd}-${mm}-${yyyy}`;
    }
    const s = String(input);
    // If ISO datetime like '2025-10-07T18:30:00.000Z' take left of T
    let datePart = s;
    if (s.indexOf('T') !== -1) datePart = s.split('T')[0];
    // If already yyyy-mm-dd
    const m = datePart.match(/^(\d{4})-(\d{2})-(\d{2})/);
    if (m) return `${m[3]}-${m[2]}-${m[1]}`;
    // fallback: try Date parse
    const parsed = new Date(s);
    if (!isNaN(parsed)) {
      const dd = String(parsed.getDate()).padStart(2, '0');
      const mm = String(parsed.getMonth() + 1).padStart(2, '0');
      const yyyy = parsed.getFullYear();
      return `${dd}-${mm}-${yyyy}`;
    }
    return s;
  }

  function renderReportsPage(page = 1, payload = null) {
    const container = document.getElementById('reportTableContainer');
    if (!container) return;

    const total = reportsDataAll.length;
    const totalPages = Math.max(1, Math.ceil(total / REPORTS_PER_PAGE));
    if (page < 1) page = 1;
    if (page > totalPages) page = totalPages;
    currentReportPage = page;

    const start = (page - 1) * REPORTS_PER_PAGE;
    const pageItems = reportsDataAll.slice(start, start + REPORTS_PER_PAGE);


    let tableHTML = '';
    if (payload && payload.reportType === 'leave') {
      // Leave Summary Report Table
      tableHTML += `
        <table class="styled-table">
          <thead>
            <tr>
              <th>Employee ID</th>
              <th>Name</th>
              <th>Dept</th>
              <th>Leave Type</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Days</th>
              <th>Reason</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
      `;
      if (pageItems.length === 0) {
        tableHTML += `<tr><td colspan="8" style="text-align:center;color:#666;padding:18px;">No records found.</td></tr>`;
      } else {
        pageItems.forEach(row => {
          const empId = row.employeeId || row.userid || row.id || 'N/A';
          const name = row.name || row.username || 'N/A';
          const dept = row.department || row.dept || 'N/A';
          const leaveType = row.leaveType || row.leave_type || 'N/A';
          const startDate = row.startDate || row.start_date || row.from || 'N/A';
          const endDate = row.endDate || row.end_date || row.to || 'N/A';
          const status = row.status || 'N/A';
          const reason = row.reason || row.leave_reason || '';
          console.log('Reports Data:', reportsDataAll);

          tableHTML += `
            <tr>
              <td>${empId}</td>
              <td>${name}</td>
              <td>${dept}</td>
              <td>${leaveType}</td>
                <td>${formatToDDMMYYYY(startDate)}</td>
                <td>${formatToDDMMYYYY(endDate)}</td>
                <td>${Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1}</td>
              <td>${reason}</td>
              <td>${status}</td>
            </tr>`;
        });
      }
      tableHTML += `</tbody></table>`;
    } else {
      // Attendance Report Table (default)
      tableHTML += `
        <table class="styled-table">
          <thead>
            <tr>
              <th>Employee</th>
              <th>Date</th>
              <th>Status</th>
              <th>Hours Worked</th>
              <th>Department</th>
              <th>Discrepancies</th>
            </tr>
          </thead>
          <tbody>
      `;
      if (pageItems.length === 0) {
        tableHTML += `<tr><td colspan="7" style="text-align:center;color:#666;padding:18px;">No records found.</td></tr>`;
      } else {
    pageItems.forEach(row => {
      const empId = row.employeeId || row.userid || row.id || 'N/A';
      const name = row.name || row.username || 'N/A';
      const dept = row.department || row.dept || 'N/A';
      const rawHours = (typeof row.hoursWorked !== 'undefined' ? row.hoursWorked : (typeof row.hours_worked !== 'undefined' ? row.hours_worked : null));
      // Format hours into "X hours Y minutes" when numeric
      const hours = (rawHours !== null && rawHours !== undefined && rawHours !== '') ? formatHoursMinutes(rawHours) : 'N/A';
      const rawDate = row.date || row.day || row.start_time || row.startTime || null;
      const date = rawDate ? formatToDDMMYYYY(rawDate) : 'N/A';
          let status = 'N/A';
          if (typeof row.status === 'string' && row.status.trim() !== '') {
            status = row.status;
          } else if (typeof row.hoursWorked !== 'undefined' && row.hoursWorked !== null) {
            status = Number(row.hoursWorked) > 0 ? 'Present' : 'Absent';
          } else if (typeof row.hours_worked !== 'undefined' && row.hours_worked !== null) {
            status = Number(row.hours_worked) > 0 ? 'Present' : 'Absent';
          }
          const discrepancies = row.discrepancies || '';
          tableHTML += `
            <tr>
              
              <td>${name} (${empId})</td>
              <td>${date}</td>
              <td>${status}</td>
              <td>${hours}</td>
              <td>${dept}</td>
              <td>${discrepancies}</td>
            </tr>`;
        });
      }
      tableHTML += `</tbody></table>`;
    }

    // Insert pagination container below table
    container.innerHTML = `
      <h3>Generated Report: ${payload ? String(payload.reportType).toUpperCase() : ''}</h3>
      <p>Department: ${payload ? payload.department : ''}, Employee: ${payload ? payload.employeeId : ''}, Date Range: ${payload ? payload.startDate : ''} to ${payload ? payload.endDate : ''}</p>
      ${tableHTML}
      <div id="reportPagination" class="pagination" style="margin-top:12px; display:flex; gap:8px; align-items:center;"></div>
    `;

    renderReportPaginationControls(totalPages, payload);
  }

  function renderReportPaginationControls(totalPages, payload) {
    const container = document.getElementById('reportPagination');
    if (!container) return;
    container.innerHTML = '';

    const prev = document.createElement('button');
    prev.textContent = 'Prev';
    prev.disabled = currentReportPage === 1;
    prev.onclick = () => renderReportsPage(currentReportPage - 1, payload);
    container.appendChild(prev);

    const maxButtons = 7;
    let startPage = 1;
    let endPage = totalPages;
    if (totalPages > maxButtons) {
      const half = Math.floor(maxButtons / 2);
      startPage = Math.max(1, currentReportPage - half);
      endPage = startPage + maxButtons - 1;
      if (endPage > totalPages) {
        endPage = totalPages;
        startPage = endPage - maxButtons + 1;
      }
    }

    if (startPage > 1) {
      const btn = document.createElement('button');
      btn.textContent = '1';
      btn.className = 'page-number';
  btn.onclick = () => renderReportsPage(1, payload);
      container.appendChild(btn);
      if (startPage > 2) {
        const dots = document.createElement('span');
        dots.textContent = '...';
        dots.style.margin = '0 6px';
        container.appendChild(dots);
      }
    }

    for (let i = startPage; i <= endPage; i++) {
      const btn = document.createElement('button');
      btn.textContent = String(i);
      btn.className = 'page-number' + (i === currentReportPage ? ' active' : '');
  btn.onclick = () => renderReportsPage(i, payload);
      container.appendChild(btn);
    }

    if (endPage < totalPages) {
      if (endPage < totalPages - 1) {
        const dots = document.createElement('span');
        dots.textContent = '...';
        dots.style.margin = '0 6px';
        container.appendChild(dots);
      }
      const btn = document.createElement('button');
      btn.textContent = String(totalPages);
      btn.className = 'page-number';
  btn.onclick = () => renderReportsPage(totalPages, payload);
      container.appendChild(btn);
    }

    const next = document.createElement('button');
    next.textContent = 'Next';
    next.disabled = currentReportPage === totalPages || totalPages === 0;
  next.onclick = () => renderReportsPage(currentReportPage + 1, payload);
    container.appendChild(next);

    const info = document.createElement('span');
    info.className = 'page-info';
    const from = total === 0 ? 0 : ((currentReportPage - 1) * REPORTS_PER_PAGE) + 1;
    const to = Math.min(currentReportPage * REPORTS_PER_PAGE, reportsDataAll.length);
    info.textContent = `Showing ${from}-${to} of ${reportsDataAll.length}`;
    container.appendChild(info);
  }

  // Submit handler uses paginated renderer
  document.getElementById('reportForm').addEventListener('submit', function(e) {
    e.preventDefault(); // Prevent page reload

    // Collect form data
    const reportType = document.querySelector('input[name="reportType"]:checked').value;
    const department = document.getElementById('department').value;
    const employeeId = document.getElementById('employeeId').value || "All Employees";
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    const payload = { reportType, department, employeeId, startDate, endDate };

    fetch('/generate-report', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
    .then(response => response.json())
    .then(data => {
      console.log('Fetched Data:', data);
      reportsDataAll = Array.isArray(data) ? data : [];
      currentReportPage = 1;
      renderReportsPage(currentReportPage, payload);
    })
    .catch(error => { console.error('Error fetching report:', error); });
  });
</script>
<script>
  // Show the reports section and render a personal attendance report.
  // Tries common endpoints and falls back to a small sample if none available.
  async function showMyAttendanceReport() {
    // Hide all sections and show reports
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
    const reportsSection = document.getElementById('reports');
    if (reportsSection) reportsSection.style.display = 'block';

    // Mark report type as attendance (if radio exists)
    const attendanceRadio = document.querySelector('input[name="reportType"][value="attendance"]');
    if (attendanceRadio) attendanceRadio.checked = true;

    // Attempt to fetch attendance from a few likely endpoints
    const endpoints = ['/api/myattendance', '/attendance', '/api/attendance', '/summary'];
    let attendanceData = null;

    for (const ep of endpoints) {
      try {
        const res = await fetch(ep);
        if (!res.ok) continue;
        const json = await res.json();
        // normalize: if object contains list under data or records, pick that
        if (Array.isArray(json)) {
          attendanceData = json;
          break;
        } else if (Array.isArray(json.data)) {
          attendanceData = json.data;
          break;
        } else if (Array.isArray(json.records)) {
          attendanceData = json.records;
          break;
        } else if (json && Object.keys(json).length && (json.start_time || json.hours_worked)) {
          // single-summary object -> convert to array
          attendanceData = [json];
          break;
        }
      } catch (err) {
        // try next endpoint
        console.warn('fetch', ep, 'failed', err);
      }
    }

    // Fallback sample if no data
    if (!Array.isArray(attendanceData) || attendanceData.length === 0) {
      const today = new Date().toISOString().split('T')[0];
      attendanceData = [
        { employeeId: window.userId || 'EMP02', name: 'You', department: 'N/A', status: 'Present', discrepancies: '', time_in: '09:00', time_out: '17:30', date: today }
      ];
    }

    // Build table HTML
    let tableHTML = `
      <table border="1" cellspacing="0" cellpadding="8" style="width:100%; border-collapse:collapse;">
        <thead style="background:#f2f2f2;">
          <tr>
            <th>Employee ID</th>
            <th>Name</th>
            <th>Department</th>
            <th>Date</th>
            <th>Status</th>
            <th>Discrepancies</th>
            <th>Time In</th>
            <th>Time Out</th>
          </tr>
        </thead>
        <tbody>
    `;

    attendanceData.forEach(row => {
      const id = row.employeeId || row.userid || row.id || row.userId || (row.userid && row.userid) || (window.userId || '');
      const name = row.name || row.username || '‚Äî';
      const dept = row.department || row.dept || '‚Äî';
      const dateRaw = row.date || row.day || row.start_time || row.startTime || null;
      const date = dateRaw ? formatToDDMMYYYY(dateRaw) : '‚Äî';
      const status = row.status || row.attendance_status || (row.hours_worked ? 'Present' : '‚Äî');
      const discrepancies = row.discrepancies || '';
      const timeIn = row.time_in || row.start_time ? (row.time_in || (row.start_time ? new Date(row.start_time).toLocaleTimeString() : '‚Äî')) : '‚Äî';
      const timeOut = row.time_out || row.end_time ? (row.time_out || (row.end_time ? new Date(row.end_time).toLocaleTimeString() : '‚Äî')) : '‚Äî';

      tableHTML += `
        <tr>
          <td>${id}</td>
          <td>${name}</td>
          <td>${dept}</td>
          <td>${date}</td>
          <td>${status}</td>
          <td>${discrepancies}</td>
          <td>${timeIn}</td>
          <td>${timeOut}</td>
        </tr>
      `;
    });

    tableHTML += `
        </tbody>
      </table>`;

    // Render into the existing report container
    const container = document.getElementById('reportTableContainer');
    if (container) {
      container.innerHTML = `
        <h3>My Attendance Report</h3>
        <p>Showing recent attendance for ${window.userId || 'You'}</p>
        ${tableHTML}
      `;
    } else {
      // Fallback: open reports in a new window
      const w = window.open();
      w.document.body.innerHTML = `<h3>My Attendance Report</h3>${tableHTML}`;
    }
  }
  // Export to Excel functionality
  document.getElementById('exportExcelBtn').addEventListener('click', function () {
    const table = document.querySelector('#reportTableContainer table');
    if (!table) {
      alert('No report table to export!');
      return;
    }

    let csv = '';
    // Get headers
    const rows = table.querySelectorAll('tr');
    for (let i = 0; i < rows.length; i++) {
      const cols = rows[i].querySelectorAll('th,td');
      let row = [];
      cols.forEach(col => {
        // Escape double quotes and commas
        let text = col.innerText.replace(/"/g, '""');
        if (text.indexOf(',') !== -1 || text.indexOf('"') !== -1) {
          text = '"' + text + '"';
        }
        row.push(text);
      });
      csv += row.join(',') + '\r\n';
    }

    // Download CSV
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'report.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  });
</script>
      

    
  </div>
</section>


          

     
            <!-- Employee Directory Section -->

  <!-- Employee Directory Section -->
   <style>
    /* Add this to your styles */
.employee-directory-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
}

.employee-directory-header .search-filters {
    flex: 1;
}

.employee-directory-header .btn {
    white-space: nowrap;
}
   </style>
      <section id="employee-directory" class="section">
                  <div class="section-header">
                      <h1>Employee Directory</h1>
                      <p>View and manage employee details</p>
                  </div>
                  <div class="employee-directory-container">
                      <div class="employee-directory-header">
                          <div class="search-filters">
                              <input type="text" id="searchInput" placeholder="Search by Name, ID or Department...">
                          </div>
              <a href="add_employee.html" class="btn btn-primary">
                <i class="fas fa-user-plus"></i> Add Employee
              </a>
                      </div>


                      <div id="addEmployeeModal" class="modal">
                      <div class="modal-content">
                          <form id="employeeForm" method="POST" action="/addEmployee">
                          <h3>Add New Employee</h3>
                          <p>Enter the employee's details below.</p>
                          <!-- Personal Details -->
                          <div class="form-section">
                              <label>Full Name</label>
                              <input type="text" name="username" placeholder="e.g.Sarath" required>
                              
                              <label>Employee ID</label>
                              <input type="text" name="userid" placeholder="e.g. EMP12345" required>

                              <label>password</label>
                              <input type="text" name="password" placeholder="e.g. 123" required>
                              
                              <label>Date of Birth</label>
                              <input type="date" name="dob" required>
                              
                              <label>Date of Joining</label>
                              <input type="date" name="doj" required>
                              
                              <label>Email</label>
                              <input type="email" name="email" placeholder="e.g. sar@gmail.com" required>
                              
                              <label>Phone Number</label>
                              <input type="tel" name="phone" placeholder="e.g.0349568" required>
                              
                              <label>Address</label>
                              <input type="text" name="address" placeholder="123 Main St, Anytown, USA">
                          </div>
                          <!-- Position Details -->
                          <div class="form-section">
                              <h4>Position Details</h4>
                              <label>Department</label>
                              <select name="department" required>
                              <option value="">Select department</option>
                              <option value="HR">HR</option>
                              <option value="IT">IT</option>
                              <option value="Finance">Finance</option>
                              <option value="Operations">Operations</option>

                              <!-- Add more options as needed -->
                              </select>
                              
                              <label>Designation</label>
                              <select name="designation" required>
                              <option value="">Select designation</option>
                                
                                <option value="Developer">Developer</option>
                              <option value="Representative">Representative</option>
                              <option value="Manager">Manager</option>
                              <option value="Specialist">Specialist</option>
                              <option value="Analyst">Analyst</option>
                              <option value="Legal">Legal</option>
                            
                              
                              </select>
                              
                              <label>Employee Type</label>
                              <div class="employee-type-group">
                              <label><input type="radio" name="employee_type" value="Regular" required> Regular</label>
                              <label><input type="radio" name="employee_type" value="Outsourced"> Out Sourced</label>
                              <label><input type="radio" name="employee_type" value="OnContract"> On Contract</label>
                              <label><input type="radio" name="employee_type" value="Apprentice"> Apprentice</label>
                              <label><input type="radio" name="employee_type" value="Intern"> Intern</label>
                              </div>
                          </div>
                          <!-- Status -->
                          <label>Status</label>
                          <select name="status">
                              <option value="active">Active</option>
                              <option value="inactive">Inactive</option>
                          </select>
                          <label>Role</label>
                          <select name="role">
                              <option value="employee">employee</option>
                              <option value="manager">manager</option>
                              <option value="admin">admin</option>
                          </select>

                          <!-- Buttons -->
                          <div class="form-actions">
                              <button type="submit">Add Employee</button>
                              <button type="button" class="close-modal" onclick="closeAddEmployeeModal()">Cancel</button>
                          </div>
                          </form>
                      </div>
            ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†</div>
            


  <!-- Employee Table -->
  <table id="employeeTable" class="styled-table">
    <thead>
      <tr>
        <th>EMPLOYEE ID</th>
        <th>Name</th>
        <th>Department</th>
        <th>Designation</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    
    <tbody>
      <!-- Populated dynamically -->
       
      
    </tbody>
  </table>
  <!-- Pagination controls -->
  <div id="employeePagination" class="pagination" style="margin-top:12px; display:flex; gap:8px; align-items:center;"></div>
              </section>
              <style>
                .input-error {
  color: red;
  font-size: 12px;
  margin-top: 4px;
}
/* Simple pagination styling */
.pagination { font-family: inherit; }
.pagination button {
  background: #fff;
  border: 1px solid #ddd;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
}
.pagination button:hover { background: #f4f6fb; }
.pagination button[disabled] { opacity: 0.5; cursor: default; }
.pagination .page-number.active {
  background: #3a86ff; color: #fff; border-color: #2a6cd4;
}
.pagination .page-info { color: #555; margin-left: 8px; }
              </style>
  <script>
  // Pagination configuration
  const EMPLOYEES_PER_PAGE = 10;
  let employeesDataAll = [];
  let employeesFiltered = [];
  let currentEmployeePage = 1;

  async function loadEmployees() {
      try {
          const response = await fetch('/employees');
          const data = await response.json();

          // store fetched data and initialize filtered view
          employeesDataAll = Array.isArray(data) ? data : [];
          employeesFiltered = employeesDataAll.slice();
          currentEmployeePage = 1;
          renderEmployeesPage(currentEmployeePage);
      } catch (error) {
          console.error('Error loading employees:', error);
      }
  }

  function renderEmployeesPage(page = 1) {
      const tbody = document.querySelector('#employeeTable tbody');
      tbody.innerHTML = '';

      const total = employeesFiltered.length;
      const totalPages = Math.max(1, Math.ceil(total / EMPLOYEES_PER_PAGE));
      if (page < 1) page = 1;
      if (page > totalPages) page = totalPages;
      currentEmployeePage = page;

      const start = (page - 1) * EMPLOYEES_PER_PAGE;
      const pageItems = employeesFiltered.slice(start, start + EMPLOYEES_PER_PAGE);

    if (pageItems.length === 0) {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td colspan="6" style="text-align:center;color:#666;padding:18px;">No records found.</td>`;
      tbody.appendChild(tr);
    } else {
      pageItems.forEach(emp => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
              <td>${emp.userid}</td>
              <td>${emp.username}</td>
              <td>${emp.department}</td>
              <td>${emp.designation}</td>
              <td>${emp.status}</td>
         <td>
          <a href="#" onclick="openMyProfileModal('${emp.userid}'); return false;">View Profile</a></td>
                  <div id="myProfileModal" class="modal" style="display:none;">
  <div class="modal-content profile-container">
    <span class="close-btn" onclick="closeMyProfileModal()">&times;</span>
    <h2>My Profile</h2>
    <div class="profile-row">
      <div class="profile-col">
        <h3>Personal Details</h3>
        <div>
          <label>Full Name</label>
          <div id="profile_fullName"></div>
        </div>
        <div>
          <label>Date of Birth</label>
          <div id="profile_dob"></div>
        </div>
      </div>
      <div class="profile-col">
        <div>
          <label>Contact Number</label>
          <div id="profile_contact"></div>
        </div>
        <div>
          <label>Address</label>
          <div id="profile_address"></div>
        </div>
      </div>
    </div>
    <div class="profile-row">
      <div class="profile-col">
        <h3>Job Details</h3>
        <div>
          <label>Employee ID</label>
          <div id="profile_empid"></div>
        </div>
        <div>
          <label>Designation</label>
          <div id="profile_designation"></div>
        </div>
        <div>
          <label>Employee Type</label>
          <div id="profile_type"></div>
        </div>
      </div>
      <div class="profile-col">
        <div>
          <label>Department</label>
          <div id="profile_department"></div>
        </div>
        <div>
          <label>Date of Joining</label>
          <div id="profile_joining"></div>
        </div>
      </div>
    </div>
    <div class="leave-balance-row">
      <h3>Leave Balances</h3>
      <div class="leave-item">
        <label>Casual Leave</label>
        <div id="profile_casualLeave" class="leave-value"></div>
      </div>
      <div class="leave-item">
        <label>Earned Leave</label>
        <div id="profile_earnedLeave" class="leave-value"></div>
      </div>
      <div class="leave-item">
        <label>Hospital Leave</label>
        <div id="profile_hospitalLeave" class="leave-value"></div>
      </div>
    </div>
    <button class="request-update-btn">Request Update</button>
  </div>
</div>
</td>
          `;


          tbody.appendChild(tr);
      });
    }

      renderEmployeePaginationControls(totalPages);
  }

  function renderEmployeePaginationControls(totalPages) {
      const container = document.getElementById('employeePagination');
      if (!container) return;
    container.innerHTML = '';
    const total = employeesFiltered.length;
    if (total === 0) {
      // hide pagination when no data
      return;
    }

      const prev = document.createElement('button');
      prev.textContent = 'Prev';
      prev.disabled = currentEmployeePage === 1;
      prev.onclick = () => renderEmployeesPage(currentEmployeePage - 1);
      container.appendChild(prev);

      // page numbers (show up to 7 numbers with ellipsis when large)
      const maxButtons = 7;
      let startPage = 1;
      let endPage = totalPages;
      if (totalPages > maxButtons) {
          const half = Math.floor(maxButtons / 2);
          startPage = Math.max(1, currentEmployeePage - half);
          endPage = startPage + maxButtons - 1;
          if (endPage > totalPages) {
              endPage = totalPages;
              startPage = endPage - maxButtons + 1;
          }
      }

      if (startPage > 1) {
          const btn = document.createElement('button');
          btn.textContent = '1';
          btn.className = 'page-number';
          btn.onclick = () => renderEmployeesPage(1);
          container.appendChild(btn);
          if (startPage > 2) {
              const dots = document.createElement('span');
              dots.textContent = '...';
              dots.style.margin = '0 6px';
              container.appendChild(dots);
          }
      }

      for (let i = startPage; i <= endPage; i++) {
          const btn = document.createElement('button');
          btn.textContent = String(i);
          btn.className = 'page-number' + (i === currentEmployeePage ? ' active' : '');
          btn.onclick = () => renderEmployeesPage(i);
          container.appendChild(btn);
      }

      if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
              const dots = document.createElement('span');
              dots.textContent = '...';
              dots.style.margin = '0 6px';
              container.appendChild(dots);
          }
          const btn = document.createElement('button');
          btn.textContent = String(totalPages);
          btn.className = 'page-number';
          btn.onclick = () => renderEmployeesPage(totalPages);
          container.appendChild(btn);
      }

      const next = document.createElement('button');
      next.textContent = 'Next';
      next.disabled = currentEmployeePage === totalPages || totalPages === 0;
      next.onclick = () => renderEmployeesPage(currentEmployeePage + 1);
      container.appendChild(next);

    const info = document.createElement('span');
    info.className = 'page-info';
    const start = (currentEmployeePage - 1) * EMPLOYEES_PER_PAGE;
    const from = total === 0 ? 0 : (start + 1);
    const to = Math.min(start + EMPLOYEES_PER_PAGE, total);
    info.textContent = `Showing ${from}-${to} of ${total}`;
      container.appendChild(info);
  }


  document.addEventListener('DOMContentLoaded', loadEmployees);

  // Optional: auto-refresh after form submit
  document.getElementById('employeeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);

      const response = await fetch('/addEmployee', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
      });

      if (response.ok) {
          closeAddEmployeeModal();
          loadEmployees();
          e.target.reset();
      } else {
          alert('Error adding employee');
      }
  });
  // Search functionality
  // Search functionality (filters dataset and re-renders paginated view)
  document.getElementById('searchInput').addEventListener('input', function () {
    const searchTerm = this.value.trim().toLowerCase();
    if (!searchTerm) {
      employeesFiltered = employeesDataAll.slice();
    } else {
      employeesFiltered = employeesDataAll.filter(emp => {
        const hay = `${emp.userid} ${emp.username} ${emp.department} ${emp.designation} ${emp.status}`.toLowerCase();
        return hay.includes(searchTerm);
      });
    }
    // reset to first page when search changes
    currentEmployeePage = 1;
    renderEmployeesPage(currentEmployeePage);
  });

  document.getElementById('employeeForm').addEventListener('submit', function(e) {
    // Remove previous errors
    document.querySelectorAll('.input-error').forEach(el => el.remove());

    let valid = true;

    // Phone validation
    const phoneInput = this.phone;
    const phone = phoneInput.value.trim();
    if (!/^\d{10}$/.test(phone)) {
        showError(phoneInput, "Phone number must be exactly 10 digits.");
        valid = false;
    }

    // DOB validation (at least 18 years ago)
    const dobInput = this.dob;
    const dob = new Date(dobInput.value);
    const today = new Date();
    const minDob = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
    if (!dobInput.value || dob > minDob) {
        showError(dobInput, "Employee must be at least 18 years old.");
        valid = false;
    }

    // DOJ validation (at least 18 years after DOB)
    const dojInput = this.doj;
    const doj = new Date(dojInput.value);
    const minDoj = new Date(dob.getFullYear() + 18, dob.getMonth(), dob.getDate());
    if (!dojInput.value || doj < minDoj) {
        showError(dojInput, "Date of joining must be at least 18 years after date of birth.");
        valid = false;
    }

    if (!valid) e.preventDefault();
});

function showError(input, message) {
    let error = document.createElement('div');
    error.className = 'input-error';
    error.style.color = 'red';
    error.style.fontSize = '12px';
    error.style.marginTop = '4px';
    error.textContent = message;
    input.parentNode.insertBefore(error, input.nextSibling);
}

  </script>
  <!-- Button to test the profile view for userId EMP02 -->
  

  <script>
  // Hardcoded userId for testing
  const userId = window.userId ||'EMP02';

  function openMyProfileModal(userId) {
    if(!userId)
  {
    alert('User ID not provided');
    return;
  }
    // Clear all modal fields before fetching new data
    document.getElementById('profile_fullName').textContent = '';
    document.getElementById('profile_dob').textContent = '';
    document.getElementById('profile_contact').textContent = '';
    document.getElementById('profile_address').textContent = '';
    document.getElementById('profile_empid').textContent = '';
    document.getElementById('profile_designation').textContent = '';
    document.getElementById('profile_type').textContent = '';
    document.getElementById('profile_department').textContent = '';
    document.getElementById('profile_joining').textContent = '';
    document.getElementById('profile_casualLeave').textContent = '';
    document.getElementById('profile_earnedLeave').textContent = '';
    document.getElementById('profile_hospitalLeave').textContent = '';

    // Fetch employee data for the hardcoded userId (EMP02)
    fetch(`/employee/${userId}`)
      .then(response => response.json())
      .then(data => {
        // Populate the modal with the fetched data
        document.getElementById('profile_fullName').textContent = data.username;
        document.getElementById('profile_dob').textContent = data.dob;
        document.getElementById('profile_contact').textContent = data.phone;
        document.getElementById('profile_address').textContent = data.address;
        document.getElementById('profile_empid').textContent = data.userid;
        document.getElementById('profile_designation').textContent = data.designation;
        document.getElementById('profile_type').textContent = data.employee_type;
        document.getElementById('profile_department').textContent = data.department;
        document.getElementById('profile_joining').textContent = data.doj;
        document.getElementById('profile_casualLeave').textContent = data.casual_leave;
        document.getElementById('profile_earnedLeave').textContent = data.earned_leave;
        document.getElementById('profile_hospitalLeave').textContent = data.sick_leave;

        // Show modal
        document.getElementById('myProfileModal').style.display = 'flex';
      })
      .catch(err => {
        console.error('‚ùå Error fetching employee data:', err);
        alert('Error fetching profile data');
      });
  }

  function closeMyProfileModal() {
    document.getElementById('myProfileModal').style.display = 'none';
    
    
  }
  </script>
  <!-- Button to test the profile view for userId EMP02 -->
 

<style>/* =========================
   ADD EMPLOYEE MODAL STYLING
   ========================= */
#addEmployeeModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.55);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 900;
}

#addEmployeeModal .modal-content {
  background: #ffffff;
  border-radius: 14px;
  padding: 30px 40px;
  width: 650px;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  animation: fadeIn 0.3s ease-in-out;
  font-family: "Poppins", sans-serif;
}

#addEmployeeModal h3 {
  font-size: 24px;
  color: #1b1b1b;
  margin-bottom: 10px;
  text-align: center;
}

#addEmployeeModal p {
  font-size: 14px;
  color: #666;
  text-align: center;
  margin-bottom: 25px;
}

#addEmployeeModal .form-section {
  margin-bottom: 25px;
}

#addEmployeeModal label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: #444;
  margin-top: 15px;
}

#addEmployeeModal input,
#addEmployeeModal select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  transition: 0.2s ease;
}

#addEmployeeModal input:focus,
#addEmployeeModal select:focus {
  border-color: #3a86ff;
  box-shadow: 0 0 5px rgba(58,134,255,0.4);
  outline: none;
}

#addEmployeeModal .employee-type-group {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-top: 10px;
}

#addEmployeeModal .form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 15px;
  margin-top: 25px;
}

#addEmployeeModal button[type="submit"] {
  background: #3a86ff;
  color: #fff;
  border: none;
  padding: 10px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.3s;
}

#addEmployeeModal button[type="submit"]:hover {
  background: #2a6cd4;
}

#addEmployeeModal .close-modal {
  background: #e0e0e0;
  border: none;
  color: #333;
  padding: 10px 24px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s;
}

#addEmployeeModal .close-modal:hover {
  background: #c7c7c7;
}

/* =========================
   MY PROFILE MODAL STYLING
   ========================= */
#myProfileModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.profile-container {
  background: #fff;
  padding: 35px 50px;
  border-radius: 16px;
  max-width: 950px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
  animation: fadeIn 0.3s ease-in-out;
  font-family: "Poppins", sans-serif;
}

.profile-container h2 {
  font-size: 28px;
  font-weight: 700;
  color: #2b2b2b;
  margin-bottom: 25px;
  text-align: center;
  border-bottom: 2px solid #eaeaea;
  padding-bottom: 10px;
}

.profile-container h3 {
  font-size: 18px;
  font-weight: 600;
  color: #444;
  margin: 20px 0 10px;
}

.profile-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 35px;
  margin-bottom: 25px;
}


.profile-container label {
  font-size: 14px;
  font-weight: 600;
  color: #777;
  display: block;
  margin-bottom: 4px;
}

.profile-container div div {
  font-size: 15px;
  font-weight: 500;
  color: #222;
  padding: 6px 10px;
  border-radius: 6px;
  background: #f8f9fb;
}

/* Leave Balances */
.leave-balance-row {
  margin-top: 35px;
  border-top: 2px solid #f1f1f1;
  padding-top: 15px;
}

.leave-balance-row h3 {
  margin-bottom: 20px;
}

.leave-item {
  display: inline-block;
  width: 30%;
  text-align: center;
  background: #f5f7ff;
  padding: 15px 10px;
  border-radius: 10px;
  margin-right: 15px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}

.leave-item label {
  font-size: 13px;
  font-weight: 600;
  color: #666;
}

.leave-value {
  font-size: 22px;
  font-weight: bold;
  color: #3a86ff;
  margin-top: 5px;
}

.request-update-btn {
  margin-top: 30px;
  width: 100%;
  background: #3a86ff;
  color: white;
  border: none;
  padding: 12px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
}

.request-update-btn:hover {
  background: #2a6cd4;
}

/* Close Button */
.close-btn {
  position: absolute;
  top: 15px;
  right: 18px;
  font-size: 26px;
  color: #666;
  background: #f3f3f3;
  width: 32px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.25s ease;
}
.close-btn:hover {
  background: #3a86ff;
  color: #fff;
  transform: scale(1.1);
}

/* Animation */
@keyframes fadeIn {
  from {opacity: 0; transform: scale(0.9);}
  to {opacity: 1; transform: scale(1);}
}

  </style>



<!-- =================== Company Holidays Section =================== -->
<section id="company-holiday-section" class="company-holiday-section section">
  <div class="company-holiday-header" style="display:flex;justify-content:space-between;align-items:center;">
    <h1>Company Holidays</h1>
    <button id="company-holiday-add-btn" class="btn btn-primary">Add New Holiday</button>
  </div>
  <div class="company-holiday-table-container">
    <table class="company-holiday-table styled-table" id="company-holiday-table">
      <thead>
        <tr>
          <th>YEAR</th>
          <th>DATE</th>
          <th>NAME OF THE HOLIDAY</th>
          <th>ACTIONS</th>
        </tr>
      </thead>
      <tbody id="company-holiday-table-body">
        <tr><td colspan="4" style="text-align:center;color:#888;">Loading...</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Add Holiday Modal -->
<div id="company-holiday-modal" class="company-holiday-modal modal" style="display:none;">
  <div class="company-holiday-modal-content modal-content">
    <span class="company-holiday-modal-close close" id="company-holiday-modal-close">&times;</span>
    <h2>Add New Holiday</h2>
    <form id="company-holiday-form">
      <label for="company-holiday-year">Year</label>
      <input type="number" id="company-holiday-year" name="year" required min="2025" max="2100" placeholder="e.g. 2025">

      <label for="company-holiday-date">Date</label>
      <input type="date" id="company-holiday-date" name="date" required>

      <label for="company-holiday-name">Name of the Holiday</label>
      <input type="text" id="company-holiday-name" name="name" required>

      <div class="company-holiday-form-actions form-actions">
        <button type="button" class="btn btn-secondary" id="company-holiday-cancel-btn">Cancel</button>
        <button type="submit" class="btn btn-primary">Add Holiday</button>
      </div>
    </form>
  </div>
</div>

<!-- =================== Company Holidays Section =================== -->
<section id="company-holiday-section" class="company-holiday-section section">
  <div class="company-holiday-header" style="display:flex;justify-content:space-between;align-items:center;">
    <h1>Company Holidays</h1>
    <button id="company-holiday-add-btn" class="btn btn-primary">Add New Holiday</button>
  </div>
  <div class="company-holiday-table-container">
    <table class="company-holiday-table styled-table" id="company-holiday-table">
      <thead>
        <tr>
          <th>YEAR</th>
          <th>DATE</th>
          <th>NAME OF THE HOLIDAY</th>
          <th>ACTIONS</th>
        </tr>
      </thead>
      <tbody id="company-holiday-table-body">
        <tr><td colspan="4" style="text-align:center;color:#888;">Loading...</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Add Holiday Modal -->
<div id="company-holiday-modal" class="company-holiday-modal modal" style="display:none;">
  <div class="company-holiday-modal-content modal-content">
    <span class="company-holiday-modal-close close" id="company-holiday-modal-close">&times;</span>
    <h2>Add New Holiday</h2>
    <form id="company-holiday-form">
      <label for="company-holiday-year">Year</label>
      <input type="number" id="company-holiday-year" name="year" required min="2025" max="2100" placeholder="e.g. 2025">

      <label for="company-holiday-date">Date</label>
      <input type="date" id="company-holiday-date" name="date" required>

      <label for="company-holiday-name">Name of the Holiday</label>
      <input type="text" id="company-holiday-name" name="name" required>

      <div class="company-holiday-form-actions form-actions">
        <button type="button" class="btn btn-secondary" id="company-holiday-cancel-btn">Cancel</button>
        <button type="submit" class="btn btn-primary">Add Holiday</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Holiday Modal -->
 
<div id="company-holiday-edit-modal" class="company-holiday-modal modal" style="display:none;">
  <div class="company-holiday-modal-content modal-content">
    <span class="company-holiday-modal-close close" id="company-holiday-edit-modal-close">&times;</span>
    <h2>Edit Holiday</h2>
    <form id="company-holiday-edit-form">
      <label for="edit-holiday-year">Year</label>
      <input class="input-field" type="number" id="edit-holiday-year" name="year" required min="2025" max="2100" placeholder="e.g. 2025" aria-label="Holiday year">

      <label for="edit-holiday-date">Date</label>
      <input class="input-field" type="date" id="edit-holiday-date" name="date" required aria-label="Holiday date">

      <label for="edit-holiday-name">Name of the Holiday</label>
      <input class="input-field" type="text" id="edit-holiday-name" name="name" required placeholder="e.g. Diwali" aria-label="Holiday name">

      <div class="company-holiday-form-actions form-actions">
        <button type="button" class="btn btn-secondary" id="company-holiday-edit-cancel-btn">Cancel</button>
        <button type="submit" class="btn btn-primary" id="company-holiday-save-btn">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- Toast notification -->
<div id="holiday-toast" role="status" aria-live="polite" style="display:none; position:fixed; right:18px; bottom:18px; z-index:2000;">
  <div style="background:#0b6bff;color:#fff;padding:12px 16px;border-radius:10px;box-shadow:0 8px 30px rgba(11,107,255,0.18);font-weight:600;">Saved</div>
</div>

<script>
  let editingHolidayId = null;

function editCompanyHoliday(id) {
  // Fetch single holiday to populate edit form
  fetch(`/holidays/${id}`)
    .then(res => {
      if (!res.ok) throw new Error('Holiday not found');
      return res.json();
    })
    .then(holiday => {
      console.log('Loaded holiday for edit:', holiday);
      editingHolidayId = id;
      document.getElementById('edit-holiday-year').value = holiday.year;
      // Normalize date to YYYY-MM-DD for input[type=date]
      try {
        let d = holiday.date;
        if (!d) d = '';
        // handle ISO datetime like '2025-10-10T00:00:00.000Z'
        if (d.indexOf && d.indexOf('T') !== -1) d = d.split('T')[0];
        // If contains space, try split
        if (d.indexOf && d.indexOf(' ') !== -1) d = d.split(' ')[0];
        document.getElementById('edit-holiday-date').value = d;
      } catch (e) {
        console.warn('Could not normalize holiday.date:', holiday.date, e);
        document.getElementById('edit-holiday-date').value = holiday.date || '';
      }
      document.getElementById('edit-holiday-name').value = holiday.name;
      const modal = document.getElementById('company-holiday-edit-modal');
      modal.style.display = 'flex';
      // small animation class
      modal.querySelector('.company-holiday-modal-content').classList.add('modal-open');
      // focus the first input
      setTimeout(() => document.getElementById('edit-holiday-year').focus(), 80);
    })
    .catch(err => {
      console.error('Error loading holiday for edit:', err);
      alert('Holiday not found or failed to load');
    });
}

// Close modal
document.getElementById('company-holiday-edit-modal-close').onclick =
document.getElementById('company-holiday-edit-cancel-btn').onclick = function() {
  const modal = document.getElementById('company-holiday-edit-modal');
  modal.querySelector('.company-holiday-modal-content').classList.remove('modal-open');
  modal.style.display = 'none';
  document.getElementById('company-holiday-edit-form').reset();
  editingHolidayId = null;
};

// Handle edit form submit
document.getElementById('company-holiday-edit-form').onsubmit = async function(e) {
  e.preventDefault();
  const year = document.getElementById('edit-holiday-year').value;
  const date = document.getElementById('edit-holiday-date').value;
  const name = document.getElementById('edit-holiday-name').value;
  if (!editingHolidayId) return;
  try {
  const saveBtn = this.querySelector('#company-holiday-save-btn');
  if (saveBtn) { saveBtn.disabled = true; saveBtn.classList.add('disabled'); saveBtn.dataset.orig = saveBtn.innerHTML; saveBtn.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span> Saving...'; }

    console.log('Submitting updated holiday:', { id: editingHolidayId, year, date, name });
    const res = await fetch(`/holidays/${editingHolidayId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ year, date, name })
    });
    const text = await res.text().catch(()=>'');
    if (!res.ok) {
      console.error('PUT /holidays failed:', res.status, text);
      throw new Error(text || `Failed to update holiday (status ${res.status})`);
    }

    const modal = document.getElementById('company-holiday-edit-modal');
    modal.querySelector('.company-holiday-modal-content').classList.remove('modal-open');
    modal.style.display = 'none';
    this.reset();
    editingHolidayId = null;
    loadCompanyHolidays();
  if (saveBtn) { saveBtn.disabled = false; saveBtn.classList.remove('disabled'); saveBtn.innerHTML = saveBtn.dataset.orig || 'Save Changes'; }
    // show toast
    const toast = document.getElementById('holiday-toast');
    if (toast) {
      toast.style.display = 'block';
      setTimeout(() => { toast.style.opacity = '1'; }, 20);
      setTimeout(() => { toast.style.opacity = '0'; setTimeout(()=>toast.style.display='none',220); }, 1800);
    }
  } catch (err) {
    console.error('Error updating holiday:', err);
    alert('Error updating holiday');
  const saveBtn = this.querySelector('#company-holiday-save-btn');
  if (saveBtn) { saveBtn.disabled = false; saveBtn.classList.remove('disabled'); saveBtn.innerHTML = saveBtn.dataset.orig || 'Save Changes'; }
  }
};

// Accessibility: ESC to close the open modal and basic focus trap
document.addEventListener('keydown', function(e) {
  const modal = document.getElementById('company-holiday-edit-modal');
  if (!modal || modal.style.display !== 'flex') return;
  if (e.key === 'Escape') {
    modal.querySelector('.company-holiday-modal-content').classList.remove('modal-open');
    modal.style.display = 'none';
    editingHolidayId = null;
  }
  // Simple focus trap (Tab cycling)
  if (e.key === 'Tab') {
    const focusable = modal.querySelectorAll('a[href], button:not([disabled]), input, select, textarea');
    if (!focusable || focusable.length === 0) return;
    const first = focusable[0];
    const last = focusable[focusable.length - 1];
    if (e.shiftKey && document.activeElement === first) {
      last.focus();
      e.preventDefault();
    } else if (!e.shiftKey && document.activeElement === last) {
      first.focus();
      e.preventDefault();
    }
  }
});
</script>

<style>
/* Company Holiday Section Styling */
.company-holiday-section .company-holiday-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.company-holiday-table {
  width: 100%;
  margin-top: 20px;
}
.company-holiday-modal-content {
  background: #fff;
  margin: 6% auto;
  padding: 30px 40px;
  border-radius: 10px;
  max-width: 400px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  position: relative;
}
.company-holiday-modal-close {
  position: absolute;
  top: 15px;
  right: 20px;
  color: #aaa;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
.company-holiday-modal-close:hover {
  color: #000;
}
#company-holiday-form label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
  color: #333;
}
#company-holiday-form input[type="text"],
#company-holiday-form input[type="number"],
#company-holiday-form input[type="date"] {
  width: 100%;
  padding: 10px 12px;
  margin-bottom: 20px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
}
.company-holiday-form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

/* Edit holiday modal specific & overlay styling */
.company-holiday-modal.modal {
  position: fixed;
  inset: 0;
  display: none; /* shown by inline style or JS by setting display:block */
  align-items: center;
  justify-content: center;
  background: rgba(4, 12, 30, 0.48);
  z-index: 1000;
  backdrop-filter: saturate(1.05) blur(4px);
}
/* Edit Holiday modal: UI-consistent inputs, labels and actions */
#company-holiday-edit-modal label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: #243b53;
  font-size: 14px;
}

#company-holiday-edit-modal .input-field,
#company-holiday-edit-modal input[type="text"],
#company-holiday-edit-modal input[type="number"],
#company-holiday-edit-modal input[type="date"] {
  width: 100%;
  padding: 12px 14px;
  margin-bottom: 14px;
  border: 1px solid #d1d9e6;
  border-radius: 10px;
  background: #fbfdff;
  font-size: 14px;
  color: #0b2946;
  transition: box-shadow 160ms ease, border-color 160ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

#company-holiday-edit-modal .input-field::placeholder {
  color: #9aa6bb;
  font-style: italic;
}

#company-holiday-edit-modal .input-field:focus,
#company-holiday-edit-modal input[type="text"]:focus,
#company-holiday-edit-modal input[type="number"]:focus,
#company-holiday-edit-modal input[type="date"]:focus {
  outline: none;
  border-color: #3a86ff;
  box-shadow: 0 6px 18px rgba(58,134,255,0.12);
}

/* keep modal content but ensure spacing and responsive width */
#company-holiday-edit-modal .company-holiday-modal-content {
  max-width: 520px;
  width: calc(100% - 40px);
  padding: 26px 32px;
  border-radius: 12px;
  background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
  box-shadow: 0 18px 50px rgba(8, 24, 60, 0.18);
  transform: translateY(-6px);
  animation: fadeIn 160ms ease-out;
}

#company-holiday-edit-modal .company-holiday-modal-close {
  top: 12px;
  right: 16px;
  font-size: 26px;
  color: #6b7280;
}

#company-holiday-edit-modal h2 {
  margin: 0 0 10px 0;
  font-size: 20px;
  color: #0b2946;
}

#company-holiday-edit-modal .company-holiday-form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 12px;
}

.company-holiday-form-actions .btn {
  padding: 10px 16px;
  font-size: 14px;
  font-weight: 600;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.18s ease, transform 0.12s ease;
}

.company-holiday-form-actions .btn-primary {
  background: #3a86ff;
  color: #fff;
  border: none;
}

.company-holiday-form-actions .btn-secondary {
  background: #f3f4f6;
  color: #1f2937;
  border: none;
}

.company-holiday-form-actions .btn-primary:hover { background: #2a6cd4; }
.company-holiday-form-actions .btn-secondary:hover { background: #e9ecef; }

@media (max-width: 480px) {
  #company-holiday-edit-modal .company-holiday-modal-content {
    margin: 8% 12px;
    padding: 18px;
    width: calc(100% - 24px);
  }
}
/* Modal open animation */
.company-holiday-modal-content.modal-open {
  transform: translateY(0);
  transition: transform 180ms cubic-bezier(.2,.9,.2,1), box-shadow 180ms ease;
}
.company-holiday-modal-content { transform: translateY(-8px); }

/* Toast transition */
#holiday-toast { opacity: 0; transition: opacity 220ms ease; }

/* small spinner used inside buttons */
.btn-spinner {
  display: inline-block;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.25);
  border-top-color: rgba(255,255,255,0.9);
  margin-right: 8px;
  vertical-align: -2px;
  animation: spin 700ms linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
</style>

<script>
// Fetch and render holidays from backend
async function loadCompanyHolidays() {
  const tbody = document.getElementById('company-holiday-table-body');
  tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#888;">Loading...</td></tr>';
  try {
    const res = await fetch('/holidays');
    let data = await res.json();
    // Sort by date descending (latest first)
    data.sort((a, b) => new Date(b.date) - new Date(a.date));
    tbody.innerHTML = '';
    if (!Array.isArray(data) || data.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#888;">No holidays added.</td></tr>';
      return;
    }
    data.forEach(holiday => {
      // Defensive: support different DB column names for id (id, ID, holidayId, holiday_id)
      console.log('holiday row:', holiday);
      const hid = holiday.id ?? holiday.ID ?? holiday.holidayId ?? holiday.holiday_id ?? null;
      const safeIdAttr = hid === null ? '' : String(hid).replace(/'/g, "\\'");
      const editOnclick = hid === null ? '' : `onclick="editCompanyHoliday('${safeIdAttr}')"`;
      const deleteOnclick = hid === null ? '' : `onclick="deleteCompanyHoliday('${safeIdAttr}')"`;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${holiday.year}</td>
        <td>${formatDateDMY(holiday.date)}</td>
        <td>${holiday.name}</td>
        <td>
          ${hid !== null ? `<button class="btn btn-secondary" ${editOnclick}>Edit</button>` : '<span style="color:#c00">No ID</span>'}
          ${hid !== null ? `<button class="btn btn-secondary" ${deleteOnclick} style="background-color: #dc3545; color: white;">Delete</button>` : ''}
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#c00;">Error loading holidays</td></tr>';
  }
}
function formatDateDMY(dateStr) {
  const d = new Date(dateStr);
  if (isNaN(d)) return dateStr;
  const day = String(d.getDate()).padStart(2, '0');
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const year = d.getFullYear();
  return `${day}-${month}-${year}`;
}

// Show modal
document.getElementById('company-holiday-add-btn').onclick = function() {
  document.getElementById('company-holiday-modal').style.display = 'block';
};
// Close modal
document.getElementById('company-holiday-modal-close').onclick =
document.getElementById('company-holiday-cancel-btn').onclick = function() {
  document.getElementById('company-holiday-modal').style.display = 'none';
  document.getElementById('company-holiday-form').reset();
};

// Add holiday (POST to backend)
document.getElementById('company-holiday-form').onsubmit = async function(e) {
  e.preventDefault();
  const year = document.getElementById('company-holiday-year').value;
  const date = document.getElementById('company-holiday-date').value;
  const name = document.getElementById('company-holiday-name').value;
  try {
    const res = await fetch('/holidays', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ year, date, name })
    });
    if (!res.ok) throw new Error('Failed to add holiday');
    document.getElementById('company-holiday-modal').style.display = 'none';
    this.reset();
    loadCompanyHolidays();
  } catch (err) {
    alert('You can\'t add holiday on same date');
  }
};

// Delete holiday (DELETE to backend)
async function deleteCompanyHoliday(id) {
  if (!confirm('Are you sure you want to delete this holiday?')) return;
  try {
    const res = await fetch(`/holidays/${id}`, { method: 'DELETE' });
    if (!res.ok) throw new Error('Failed to delete');
    loadCompanyHolidays();
  } catch (err) {
    alert('Error deleting holiday');
  }
} 

//error handling for in year, date of holiday
document.getElementById('company-holiday-form').onsubmit = async function(e) {
  e.preventDefault();
  const year = parseInt(document.getElementById('company-holiday-year').value, 10);
  const date = document.getElementById('company-holiday-date').value;
  const name = document.getElementById('company-holiday-name').value.trim();

  const today = new Date();
  const inputDate = new Date(date); 
  const currentYear = today.getFullYear();

  // Validation: year must be current or future
  if (year < currentYear) {
    alert('Year must be the current year or a future year.');
    return;
  }

  // Validation: date must be strictly in the future
  today.setHours(0,0,0,0);
  inputDate.setHours(0,0,0,0);
  if (inputDate <= today) {
    alert('Date must be a future date (not today or past).');
    return;
  }

  try {
    const res = await fetch('/holidays', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ year, date, name })
    });
    if (!res.ok) throw new Error('Failed to add holiday');
    document.getElementById('company-holiday-modal').style.display = 'none';
    this.reset();
    loadCompanyHolidays();
  } catch (err) {
    alert('You can\'t add holiday on same date');
  }
};
// Initial load
document.addEventListener('DOMContentLoaded', loadCompanyHolidays);


</script>


      </main>

      <script src="script.js"></script>
  </body>
  </html>